
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitProgress - Programme d'entraînement</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4a6fa5;
            --primary-light: #6b8cbc;
            --secondary: #6bbaa7;
            --background: #f9f9f9;
            --card-bg: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --border: #e0e0e0;
            --success: #6bbaa7;
            --warning: #ffb347;
            --danger: #ff6b6b;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
        }

        .theme-dark {
            --primary: #6b8cbc;
            --primary-light: #8ba7d4;
            --secondary: #7bc9b5;
            --background: #1a1a1a;
            --card-bg: #2d2d2d;
            --text: #f0f0f0;
            --text-light: #b0b0b0;
            --border: #444444;
            --success: #7bc9b5;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.4rem;
            color: var(--primary);
        }

        .logo i {
            font-size: 1.6rem;
        }

        nav {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
        }

        .nav-btn.active {
            background-color: var(--primary);
            color: white;
        }

        .nav-btn:hover:not(.active) {
            background-color: rgba(74, 111, 165, 0.1);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .card-title i {
            font-size: 1.1rem;
        }

        .motivation {
            text-align: center;
            font-style: italic;
            color: var(--text-light);
            padding: 15px;
            background-color: rgba(107, 186, 167, 0.1);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .session {
            margin-bottom: 25px;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .session-title {
            font-weight: 600;
            color: var(--primary);
        }

        .session-duration {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .exercise {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .exercise:last-child {
            border-bottom: none;
        }

        .exercise.completed {
            background-color: rgba(107, 186, 167, 0.05);
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .exercise-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(74, 111, 165, 0.1);
            border-radius: 50%;
            margin-right: 15px;
            color: var(--primary);
        }

        .exercise-details {
            flex: 1;
        }

        .exercise-name {
            font-weight: 500;
        }

        .exercise-reps {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .exercise-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .timer-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .timer-btn:hover {
            color: var(--primary-light);
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .checkbox.checked {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
            transform: scale(1.1);
        }

        .week-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .week-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .week-btn:hover:not(:disabled) {
            background-color: rgba(74, 111, 165, 0.1);
        }

        .week-btn:disabled {
            color: var(--text-light);
            cursor: not-allowed;
        }

        .week-title {
            text-align: center;
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--border);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--success);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }

        .settings-option:last-child {
            border-bottom: none;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-light);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #ff5252;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #5aa895;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
        }

        .timer-display {
            font-size: 3rem;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            color: var(--primary);
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .badge-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
        }

        .badge-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 8px;
        }

        .badge-icon.earned {
            background-color: var(--warning);
        }

        .badge-name {
            font-size: 0.8rem;
            text-align: center;
        }

        .music-player {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
        }

        .music-controls {
            display: flex;
            gap: 10px;
        }

        .music-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .music-info {
            flex: 1;
        }

        .music-title {
            font-weight: 500;
        }

        .music-artist {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 8px 15px;
            background-color: var(--primary);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            background-color: var(--primary-light);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .profile-level {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--border);
            cursor: pointer;
        }

        .theme-btn.active {
            border-color: var(--primary);
        }

        .theme-light {
            background: linear-gradient(135deg, #f9f9f9 50%, #4a6fa5 50%);
        }

        .theme-dark {
            background: linear-gradient(135deg, #2d2d2d 50%, #6b8cbc 50%);
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            flex-direction: column;
            color: white;
            text-align: center;
        }

        .celebration.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        .celebration h1 {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .celebration p {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .note-textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            color: var(--text);
            resize: vertical;
            margin-bottom: 15px;
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            font-weight: 500;
        }

        .history-session {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            nav {
                width: 100%;
                justify-content: space-between;
            }
            
            .nav-btn {
                flex: 1;
                text-align: center;
                font-size: 0.8rem;
                padding: 8px 5px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .timer-display {
                font-size: 2.5rem;
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            .timer-modal .modal-content {
                max-width: 90%;
                padding: 15px;
            }
            
            .timer-display {
                font-size: 2.5rem;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-dumbbell"></i>
                <span>FitProgress</span>
            </div>
            <nav>
                <button class="nav-btn active" data-page="home">
                    <i class="fas fa-home"></i>
                    <span class="nav-text">Aujourd'hui</span>
                </button>
                <button class="nav-btn" data-page="week">
                    <i class="fas fa-calendar-week"></i>
                    <span class="nav-text">Semaine</span>
                </button>
                <button class="nav-btn" data-page="stats">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-text">Stats</span>
                </button>
                <button class="nav-btn" data-page="profile">
                    <i class="fas fa-user"></i>
                    <span class="nav-text">Profil</span>
                </button>
            </nav>
        </header>

        <!-- Page d'accueil (Aujourd'hui) -->
        <div id="home" class="page active">
            <div class="motivation" id="daily-motivation">
                <!-- La phrase motivante sera insérée ici par JavaScript -->
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-calendar-day"></i>
                    <span>Programme du jour</span>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="daily-progress"></div>
                </div>
                
                <div class="session">
                    <div class="session-header">
                        <div class="session-title">Matin</div>
                        <div class="session-duration" id="morning-duration">5 min</div>
                    </div>
                    <div id="morning-exercises">
                        <!-- Les exercices du matin seront insérés ici par JavaScript -->
                    </div>
                </div>
                
                <div class="session">
                    <div class="session-header">
                        <div class="session-title">Soir</div>
                        <div class="session-duration" id="evening-duration">12-15 min</div>
                    </div>
                    <div id="evening-exercises">
                        <!-- Les exercices du soir seront insérés ici par JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Lecteur de musique -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-music"></i>
                    <span>Musique d'entraînement</span>
                </div>
                <div class="music-player">
                    <div class="music-info">
                        <div class="music-title" id="music-title">Aucune musique sélectionnée</div>
                        <div class="music-artist" id="music-artist">Importer votre musique</div>
                    </div>
                    <div class="music-controls">
                        <button class="music-btn" id="prev-music">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="music-btn" id="play-music">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="music-btn" id="next-music">
                            <i class="fas fa-step-forward"></i>
                        </button>
                    </div>
                </div>
                <input type="file" id="music-file" class="file-input" accept="audio/*" multiple>
                <label for="music-file" class="file-label">
                    <i class="fas fa-upload"></i> Importer de la musique
                </label>
            </div>
        </div>

        <!-- Page de la semaine -->
        <div id="week" class="page">
            <div class="week-selector">
                <button class="week-btn" id="prev-week">
                    <i class="fas fa-chevron-left"></i> Semaine précédente
                </button>
                <div class="week-title" id="current-week">Semaine 1</div>
                <button class="week-btn" id="next-week">
                    Semaine suivante <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-calendar-week"></i>
                    <span>Programme de la semaine</span>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="weekly-progress"></div>
                </div>
                
                <div id="week-exercises">
                    <!-- Le programme de la semaine sera inséré ici par JavaScript -->
                </div>
            </div>

            <!-- Notes personnelles -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-sticky-note"></i>
                    <span>Notes de la semaine</span>
                </div>
                <textarea class="note-textarea" id="week-notes" placeholder="Ajoutez vos notes personnelles pour cette semaine..."></textarea>
                <button class="btn btn-primary" id="save-notes">
                    <i class="fas fa-save"></i> Enregistrer les notes
                </button>
            </div>
        </div>

        <!-- Page des statistiques -->
        <div id="stats" class="page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    <span>Statistiques de progression</span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-workouts">0</div>
                        <div class="stat-label">Séances complétées</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-exercises">0</div>
                        <div class="stat-label">Exercices terminés</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="current-streak">0</div>
                        <div class="stat-label">Jours consécutifs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completion-rate">0%</div>
                        <div class="stat-label">Taux de complétion</div>
                    </div>
                </div>
                
                <canvas id="progress-chart" height="250"></canvas>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-trophy"></i>
                    <span>Badges et récompenses</span>
                </div>
                
                <div class="badge-container" id="badges-container">
                    <!-- Les badges seront insérés ici par JavaScript -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    <span>Historique des séances</span>
                </div>
                
                <div id="workout-history">
                    <!-- L'historique sera inséré ici par JavaScript -->
                </div>
            </div>
        </div>

        <!-- Page du profil -->
        <div id="profile" class="page">
            <div class="card">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-info">
                        <div class="profile-name" id="profile-name">Athlète</div>
                        <div class="profile-level" id="profile-level">Niveau 1 - Débutant</div>
                    </div>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div>Objectif hebdomadaire</div>
                        <div class="text-light">Nombre de séances par semaine</div>
                    </div>
                    <select id="weekly-goal">
                        <option value="3">3 séances</option>
                        <option value="4">4 séances</option>
                        <option value="5">5 séances</option>
                        <option value="6">6 séances</option>
                        <option value="7">7 séances</option>
                    </select>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div>Thème de l'application</div>
                        <div class="text-light">Choisissez l'apparence</div>
                    </div>
                    <div class="theme-selector">
                        <button class="theme-btn theme-light active" data-theme="light"></button>
                        <button class="theme-btn theme-dark" data-theme="dark"></button>
                    </div>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div>Activer les rappels</div>
                        <div class="text-light">Notifications matin et soir</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="reminders-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-camera"></i>
                    <span>Photos de progression</span>
                </div>
                <div id="progress-photos">
                    <!-- Les photos de progression seront insérées ici par JavaScript -->
                </div>
                <input type="file" id="photo-upload" class="file-input" accept="image/*" capture="camera">
                <label for="photo-upload" class="file-label" style="margin-top: 15px;">
                    <i class="fas fa-camera"></i> Ajouter une photo
                </label>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-download"></i>
                    <span>Export des données</span>
                </div>
                <p>Exportez vos données de progression pour les sauvegarder ou les partager.</p>
                <button class="btn btn-primary" id="export-data" style="margin-top: 15px;">
                    <i class="fas fa-file-export"></i> Exporter mes données
                </button>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-sliders-h"></i>
                    <span>Paramètres avancés</span>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div>Réinitialiser la progression</div>
                        <div class="text-light">Efface toutes vos données sauvegardées</div>
                    </div>
                    <button class="btn btn-danger" id="reset-progress">Réinitialiser</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal du timer -->
    <div class="modal timer-modal" id="timer-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="timer-exercise-name">Exercice</h3>
                <button class="close-modal" id="close-timer">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="timer-display" id="timer-display">00:30</div>
            <div class="timer-controls">
                <button class="btn btn-primary" id="start-timer">
                    <i class="fas fa-play"></i> Démarrer
                </button>
                <button class="btn btn-danger" id="stop-timer" style="display: none;">
                    <i class="fas fa-stop"></i> Arrêter
                </button>
                <button class="btn btn-success" id="complete-exercise">
                    <i class="fas fa-check"></i> Terminer
                </button>
            </div>
        </div>
    </div>

    <!-- Écran de félicitations -->
    <div class="celebration" id="celebration">
        <h1>Félicitations !</h1>
        <p id="celebration-message">Vous avez terminé la semaine 1 !</p>
        <button class="btn btn-success" id="close-celebration">
            Continuer
        </button>
    </div>

    <!-- Audio pour les sons de feedback -->
    <audio id="complete-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    <audio id="timer-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>

    <script>
        // Données du programme d'entraînement
        const trainingProgram = {
            1: {
                title: "Semaine 1 : Activation + bases",
                morning: {
                    duration: "5 min",
                    exercises: [
                        { name: "Pompes", reps: "12", icon: "fa-hand-rock", duration: 30 },
                        { name: "Dips sur chaise", reps: "10", icon: "fa-chair", duration: 30 },
                        { name: "Gainage", reps: "20 sec", icon: "fa-stopwatch", duration: 20 },
                        { name: "Shoulder taps", reps: "15", icon: "fa-hands", duration: 30 }
                    ]
                },
                evening: {
                    duration: "12-15 min",
                    exercises: [
                        { name: "Pompes", reps: "4×12", icon: "fa-hand-rock", duration: 45 },
                        { name: "Dips", reps: "3×10", icon: "fa-chair", duration: 40 },
                        { name: "Gainage", reps: "3×25 sec", icon: "fa-stopwatch", duration: 25 },
                        { name: "Pompes diamant", reps: "3×15", icon: "fa-hands", duration: 40 }
                    ]
                }
            },
            2: {
                title: "Semaine 2 : Volume + forme",
                morning: {
                    duration: "5 min",
                    exercises: [
                        { name: "Pompes", reps: "15", icon: "fa-hand-rock", duration: 35 },
                        { name: "Dips", reps: "15", icon: "fa-chair", duration: 35 },
                        { name: "Gainage", reps: "30 sec", icon: "fa-stopwatch", duration: 30 },
                        { name: "Shoulder taps", reps: "20", icon: "fa-hands", duration: 35 }
                    ]
                },
                evening: {
                    duration: "15-20 min",
                    exercises: [
                        { name: "Pompes classiques", reps: "4×15", icon: "fa-hand-rock", duration: 50 },
                        { name: "Pompes diamant", reps: "4×12", icon: "fa-hands", duration: 45 },
                        { name: "Dips lents", reps: "4×12", icon: "fa-chair", duration: 40 },
                        { name: "Gainage", reps: "3×30 sec", icon: "fa-stopwatch", duration: 30 },
                        { name: "Pompes écartées", reps: "3×12", icon: "fa-hands", duration: 40 }
                    ]
                }
            },
            3: {
                title: "Semaine 3 : Hypertrophie maison",
                morning: {
                    duration: "5 min",
                    exercises: [
                        { name: "Pompes", reps: "20", icon: "fa-hand-rock", duration: 40 },
                        { name: "Dips", reps: "15", icon: "fa-chair", duration: 35 },
                        { name: "Gainage", reps: "40 sec", icon: "fa-stopwatch", duration: 40 },
                        { name: "Shoulder taps", reps: "20", icon: "fa-hands", duration: 35 }
                    ]
                },
                evening: {
                    duration: "20-25 min",
                    exercises: [
                        { name: "Pompes", reps: "5×15-20", icon: "fa-hand-rock", duration: 60 },
                        { name: "Dips", reps: "5×15", icon: "fa-chair", duration: 50 },
                        { name: "Pompes diamant", reps: "4×20", icon: "fa-hands", duration: 45 },
                        { name: "Pompes écartées", reps: "4×15", icon: "fa-hands", duration: 40 },
                        { name: "Gainage", reps: "4×45 sec", icon: "fa-stopwatch", duration: 45 }
                    ]
                }
            },
            4: {
                title: "Semaine 4 : Explosion du haut du corps",
                morning: {
                    duration: "5 min",
                    exercises: [
                        { name: "Pompes", reps: "25", icon: "fa-hand-rock", duration: 45 },
                        { name: "Dips", reps: "20", icon: "fa-chair", duration: 40 },
                        { name: "Gainage", reps: "1 min", icon: "fa-stopwatch", duration: 60 },
                        { name: "Shoulder taps", reps: "25", icon: "fa-hands", duration: 40 }
                    ]
                },
                evening: {
                    duration: "25-30 min",
                    exercises: [
                        { name: "Pompes", reps: "5×20-25", icon: "fa-hand-rock", duration: 70 },
                        { name: "Dips", reps: "5×20", icon: "fa-chair", duration: 60 },
                        { name: "Pompes diamant", reps: "5×20", icon: "fa-hands", duration: 50 },
                        { name: "Pompes écartées", reps: "5×15", icon: "fa-hands", duration: 45 },
                        { name: "Gainage", reps: "5×1 min", icon: "fa-stopwatch", duration: 60 },
                        { name: "Pompes max", reps: "3×30-40 reps", icon: "fa-fire", duration: 90 }
                    ]
                }
            }
        };

        // Phrases motivantes
        const motivationalPhrases = [
            "Chaque jour compte. Vous êtes plus fort que vous ne le pensez !",
            "La régularité est la clé du succès. Continuez comme ça !",
            "Votre corps peut supporter presque n'importe quoi. C'est votre esprit qu'il faut convaincre.",
            "Ne vous arrêtez pas quand vous avez mal. Arrêtez-vous quand vous avez terminé.",
            "Le succès est la somme de petits efforts répétés jour après jour.",
            "La seule mauvaise séance est celle que vous n'avez pas faite.",
            "Vous n'êtes pas obligé d'être extrême, juste cohérent.",
            "Le corps atteint ce que l'esprit croit.",
            "La discipline, c'est choisir entre ce que vous voulez maintenant et ce que vous voulez le plus.",
            "Ne rêvez pas de réussir. Travaillez pour y parvenir."
        ];

        // Badges disponibles
        const badges = [
            { id: "first_workout", name: "Première séance", icon: "fa-star", description: "Complétez votre première séance" },
            { id: "week_complete", name: "Semaine terminée", icon: "fa-calendar-check", description: "Terminez une semaine complète" },
            { id: "month_complete", name: "Mois d'entraînement", icon: "fa-trophy", description: "4 semaines d'entraînement" },
            { id: "streak_7", name: "7 jours consécutifs", icon: "fa-fire", description: "7 jours d'entraînement sans interruption" },
            { id: "streak_30", name: "30 jours consécutifs", icon: "fa-bolt", description: "30 jours d'entraînement sans interruption" },
            { id: "early_bird", name: "Lève-tôt", icon: "fa-sun", description: "5 séances du matin complétées" },
            { id: "night_owl", name: "Couche-tard", icon: "fa-moon", description: "5 séances du soir complétées" },
            { id: "perfectionist", name: "Perfectionniste", icon: "fa-gem", description: "100% des exercices d'une semaine complétés" }
        ];

        // Éléments DOM
        const pages = document.querySelectorAll('.page');
        const navButtons = document.querySelectorAll('.nav-btn');
        const dailyMotivation = document.getElementById('daily-motivation');
        const morningExercises = document.getElementById('morning-exercises');
        const eveningExercises = document.getElementById('evening-exercises');
        const morningDuration = document.getElementById('morning-duration');
        const eveningDuration = document.getElementById('evening-duration');
        const currentWeek = document.getElementById('current-week');
        const weekExercises = document.getElementById('week-exercises');
        const prevWeekBtn = document.getElementById('prev-week');
        const nextWeekBtn = document.getElementById('next-week');
        const dailyProgress = document.getElementById('daily-progress');
        const weeklyProgress = document.getElementById('weekly-progress');
        const resetProgressBtn = document.getElementById('reset-progress');
        const timerModal = document.getElementById('timer-modal');
        const timerDisplay = document.getElementById('timer-display');
        const timerExerciseName = document.getElementById('timer-exercise-name');
        const startTimerBtn = document.getElementById('start-timer');
        const stopTimerBtn = document.getElementById('stop-timer');
        const completeExerciseBtn = document.getElementById('complete-exercise');
        const closeTimerBtn = document.getElementById('close-timer');
        const celebration = document.getElementById('celebration');
        const celebrationMessage = document.getElementById('celebration-message');
        const closeCelebrationBtn = document.getElementById('close-celebration');
        const completeSound = document.getElementById('complete-sound');
        const timerSound = document.getElementById('timer-sound');
        const totalWorkoutsEl = document.getElementById('total-workouts');
        const totalExercisesEl = document.getElementById('total-exercises');
        const currentStreakEl = document.getElementById('current-streak');
        const completionRateEl = document.getElementById('completion-rate');
        const badgesContainer = document.getElementById('badges-container');
        const workoutHistory = document.getElementById('workout-history');
        const progressChart = document.getElementById('progress-chart');
        const profileName = document.getElementById('profile-name');
        const profileLevel = document.getElementById('profile-level');
        const weeklyGoal = document.getElementById('weekly-goal');
        const themeButtons = document.querySelectorAll('.theme-btn');
        const remindersToggle = document.getElementById('reminders-toggle');
        const progressPhotos = document.getElementById('progress-photos');
        const photoUpload = document.getElementById('photo-upload');
        const exportDataBtn = document.getElementById('export-data');
        const weekNotes = document.getElementById('week-notes');
        const saveNotesBtn = document.getElementById('save-notes');
        const musicFile = document.getElementById('music-file');
        const musicTitle = document.getElementById('music-title');
        const musicArtist = document.getElementById('music-artist');
        const playMusicBtn = document.getElementById('play-music');
        const prevMusicBtn = document.getElementById('prev-music');
        const nextMusicBtn = document.getElementById('next-music');

        // Variables d'état
        let currentWeekNumber = 1;
        let completedExercises = JSON.parse(localStorage.getItem('completedExercises')) || {};
        let workoutHistoryData = JSON.parse(localStorage.getItem('workoutHistory')) || [];
        let earnedBadges = JSON.parse(localStorage.getItem('earnedBadges')) || [];
        let userSettings = JSON.parse(localStorage.getItem('userSettings')) || {
            name: "Athlète",
            weeklyGoal: 5,
            theme: "light",
            reminders: false
        };
        let weekNotesData = JSON.parse(localStorage.getItem('weekNotes')) || {};
        let progressPhotosData = JSON.parse(localStorage.getItem('progressPhotos')) || [];
        let currentTimer = null;
        let currentExerciseId = null;
        let timerInterval = null;
        let timerSeconds = 0;
        let musicFiles = [];
        let currentMusicIndex = 0;
        let audioPlayer = new Audio();
        let isPlaying = false;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les données sauvegardées
            loadProgress();
            loadUserSettings();
            loadWeekNotes();
            loadProgressPhotos();
            
            // Afficher la page d'accueil
            showPage('home');
            
            // Afficher la phrase motivante du jour
            showDailyMotivation();
            
            // Afficher le programme du jour
            displayTodayProgram();
            
            // Afficher le programme de la semaine
            displayWeekProgram();
            
            // Afficher les statistiques
            displayStats();
            
            // Afficher les badges
            displayBadges();
            
            // Afficher l'historique
            displayWorkoutHistory();
            
            // Configurer les écouteurs d'événements
            setupEventListeners();
            
            // Vérifier les badges
            checkBadges();
            
            // Vérifier si une semaine est terminée
            checkWeekCompletion();
        });

        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            // Navigation
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                    
                    // Mettre à jour l'état actif des boutons
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Navigation entre les semaines
            prevWeekBtn.addEventListener('click', function() {
                if (currentWeekNumber > 1) {
                    currentWeekNumber--;
                    displayWeekProgram();
                    loadWeekNotes();
                }
            });
            
            nextWeekBtn.addEventListener('click', function() {
                if (currentWeekNumber < Object.keys(trainingProgram).length) {
                    currentWeekNumber++;
                    displayWeekProgram();
                    loadWeekNotes();
                }
            });
            
            // Timer
            startTimerBtn.addEventListener('click', startTimer);
            stopTimerBtn.addEventListener('click', stopTimer);
            completeExerciseBtn.addEventListener('click', completeExerciseWithTimer);
            closeTimerBtn.addEventListener('click', closeTimer);
            
            // Célébration
            closeCelebrationBtn.addEventListener('click', closeCelebration);
            
            // Réinitialiser la progression
            resetProgressBtn.addEventListener('click', function() {
                if (confirm("Êtes-vous sûr de vouloir réinitialiser toute votre progression ? Cette action est irréversible.")) {
                    localStorage.removeItem('completedExercises');
                    localStorage.removeItem('workoutHistory');
                    localStorage.removeItem('earnedBadges');
                    localStorage.removeItem('weekNotes');
                    localStorage.removeItem('progressPhotos');
                    completedExercises = {};
                    workoutHistoryData = [];
                    earnedBadges = [];
                    weekNotesData = {};
                    progressPhotosData = [];
                    loadProgress();
                    displayTodayProgram();
                    displayWeekProgram();
                    displayStats();
                    displayBadges();
                    displayWorkoutHistory();
                    alert("Progression réinitialisée avec succès !");
                }
            });
            
            // Paramètres utilisateur
            weeklyGoal.addEventListener('change', function() {
                userSettings.weeklyGoal = parseInt(this.value);
                saveUserSettings();
            });
            
            themeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    setTheme(theme);
                    
                    themeButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            remindersToggle.addEventListener('change', function() {
                userSettings.reminders = this.checked;
                saveUserSettings();
                
                if (this.checked) {
                    setupReminders();
                }
            });
            
            // Photos de progression
            photoUpload.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const photoData = {
                            id: Date.now(),
                            data: event.target.result,
                            date: new Date().toISOString()
                        };
                        progressPhotosData.push(photoData);
                        saveProgressPhotos();
                        displayProgressPhotos();
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Export des données
            exportDataBtn.addEventListener('click', exportData);
            
            // Notes de la semaine
            saveNotesBtn.addEventListener('click', saveWeekNotes);
            
            // Musique
            musicFile.addEventListener('change', function(e) {
                if (e.target.files && e.target.files.length > 0) {
                    musicFiles = Array.from(e.target.files);
                    currentMusicIndex = 0;
                    loadMusic(currentMusicIndex);
                }
            });
            
            playMusicBtn.addEventListener('click', toggleMusic);
            prevMusicBtn.addEventListener('click', prevMusic);
            nextMusicBtn.addEventListener('click', nextMusic);
            
            audioPlayer.addEventListener('ended', nextMusic);
        }

        // Afficher une page spécifique
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Mettre à jour les données si nécessaire
            if (pageId === 'stats') {
                displayStats();
                displayBadges();
                displayWorkoutHistory();
            } else if (pageId === 'profile') {
                displayProgressPhotos();
            }
        }

        // Afficher la phrase motivante du jour
        function showDailyMotivation() {
            const today = new Date().getDate();
            const phraseIndex = today % motivationalPhrases.length;
            dailyMotivation.textContent = motivationalPhrases[phraseIndex];
        }

        // Afficher le programme du jour
        function displayTodayProgram() {
            const weekData = trainingProgram[currentWeekNumber];
            
            // Mettre à jour les durées
            morningDuration.textContent = weekData.morning.duration;
            eveningDuration.textContent = weekData.evening.duration;
            
            // Afficher les exercices du matin
            morningExercises.innerHTML = '';
            weekData.morning.exercises.forEach((exercise, index) => {
                const exerciseId = `week${currentWeekNumber}-morning-${index}`;
                const isCompleted = completedExercises[exerciseId] || false;
                
                const exerciseElement = createExerciseElement(exercise, exerciseId, isCompleted);
                morningExercises.appendChild(exerciseElement);
            });
            
            // Afficher les exercices du soir
            eveningExercises.innerHTML = '';
            weekData.evening.exercises.forEach((exercise, index) => {
                const exerciseId = `week${currentWeekNumber}-evening-${index}`;
                const isCompleted = completedExercises[exerciseId] || false;
                
                const exerciseElement = createExerciseElement(exercise, exerciseId, isCompleted);
                eveningExercises.appendChild(exerciseElement);
            });
            
            // Mettre à jour la barre de progression du jour
            updateDailyProgress();
        }

        // Afficher le programme de la semaine
        function displayWeekProgram() {
            const weekData = trainingProgram[currentWeekNumber];
            
            // Mettre à jour le titre de la semaine
            currentWeek.textContent = weekData.title;
            
            // Afficher les exercices de la semaine
            weekExercises.innerHTML = '';
            
            // Section matin
            const morningSection = document.createElement('div');
            morningSection.className = 'session';
            
            const morningHeader = document.createElement('div');
            morningHeader.className = 'session-header';
            morningHeader.innerHTML = `
                <div class="session-title">Matin</div>
                <div class="session-duration">${weekData.morning.duration}</div>
            `;
            morningSection.appendChild(morningHeader);
            
            weekData.morning.exercises.forEach((exercise, index) => {
                const exerciseId = `week${currentWeekNumber}-morning-${index}`;
                const isCompleted = completedExercises[exerciseId] || false;
                
                const exerciseElement = createExerciseElement(exercise, exerciseId, isCompleted);
                morningSection.appendChild(exerciseElement);
            });
            
            weekExercises.appendChild(morningSection);
            
            // Section soir
            const eveningSection = document.createElement('div');
            eveningSection.className = 'session';
            
            const eveningHeader = document.createElement('div');
            eveningHeader.className = 'session-header';
            eveningHeader.innerHTML = `
                <div class="session-title">Soir</div>
                <div class="session-duration">${weekData.evening.duration}</div>
            `;
            eveningSection.appendChild(eveningHeader);
            
            weekData.evening.exercises.forEach((exercise, index) => {
                const exerciseId = `week${currentWeekNumber}-evening-${index}`;
                const isCompleted = completedExercises[exerciseId] || false;
                
                const exerciseElement = createExerciseElement(exercise, exerciseId, isCompleted);
                eveningSection.appendChild(exerciseElement);
            });
            
            weekExercises.appendChild(eveningSection);
            
            // Mettre à jour la barre de progression de la semaine
            updateWeeklyProgress();
            
            // Mettre à jour l'état des boutons de navigation des semaines
            prevWeekBtn.disabled = currentWeekNumber === 1;
            nextWeekBtn.disabled = currentWeekNumber === Object.keys(trainingProgram).length;
        }

        // Créer un élément d'exercice
        function createExerciseElement(exercise, exerciseId, isCompleted) {
            const exerciseElement = document.createElement('div');
            exerciseElement.className = `exercise ${isCompleted ? 'completed' : ''}`;
            
            exerciseElement.innerHTML = `
                <div class="exercise-icon">
                    <i class="fas ${exercise.icon}"></i>
                </div>
                <div class="exercise-details">
                    <div class="exercise-name">${exercise.name}</div>
                    <div class="exercise-reps">${exercise.reps}</div>
                </div>
                <div class="exercise-actions">
                    <button class="timer-btn" data-exercise-id="${exerciseId}" data-exercise-name="${exercise.name}" data-duration="${exercise.duration}">
                        <i class="fas fa-stopwatch"></i>
                    </button>
                    <div class="checkbox ${isCompleted ? 'checked' : ''}" data-exercise-id="${exerciseId}">
                        ${isCompleted ? '<i class="fas fa-check"></i>' : ''}
                    </div>
                </div>
            `;
            
            // Ajouter un écouteur d'événement pour la case à cocher
            const checkbox = exerciseElement.querySelector('.checkbox');
            checkbox.addEventListener('click', function() {
                const id = this.getAttribute('data-exercise-id');
                toggleExerciseCompletion(id);
            });
            
            // Ajouter un écouteur d'événement pour le timer
            const timerBtn = exerciseElement.querySelector('.timer-btn');
            timerBtn.addEventListener('click', function() {
                const id = this.getAttribute('data-exercise-id');
                const name = this.getAttribute('data-exercise-name');
                const duration = parseInt(this.getAttribute('data-duration'));
                openTimer(id, name, duration);
            });
            
            return exerciseElement;
        }

        // Ouvrir le timer pour un exercice
        function openTimer(exerciseId, exerciseName, duration) {
            currentExerciseId = exerciseId;
            timerSeconds = duration;
            timerExerciseName.textContent = exerciseName;
            updateTimerDisplay();
            
            timerModal.classList.add('active');
            startTimerBtn.style.display = 'block';
            stopTimerBtn.style.display = 'none';
        }

        // Fermer le timer
        function closeTimer() {
            timerModal.classList.remove('active');
            stopTimer();
        }

        // Démarrer le timer
        function startTimer() {
            startTimerBtn.style.display = 'none';
            stopTimerBtn.style.display = 'block';
            
            timerInterval = setInterval(function() {
                timerSeconds--;
                updateTimerDisplay();
                
                if (timerSeconds <= 0) {
                    stopTimer();
                    timerSound.play();
                    completeExerciseWithTimer();
                }
            }, 1000);
        }

        // Arrêter le timer
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Mettre à jour l'affichage du timer
        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Terminer l'exercice avec le timer
        function completeExerciseWithTimer() {
            if (currentExerciseId) {
                toggleExerciseCompletion(currentExerciseId);
                closeTimer();
            }
        }

        // Basculer l'état de complétion d'un exercice
        function toggleExerciseCompletion(exerciseId) {
            completedExercises[exerciseId] = !completedExercises[exerciseId];
            localStorage.setItem('completedExercises', JSON.stringify(completedExercises));
            
            // Jouer le son de feedback
            if (completedExercises[exerciseId]) {
                completeSound.play();
                
                // Ajouter à l'historique
                const now = new Date();
                const historyEntry = {
                    date: now.toISOString(),
                    exerciseId: exerciseId,
                    type: exerciseId.includes('morning') ? 'Matin' : 'Soir'
                };
                workoutHistoryData.unshift(historyEntry);
                localStorage.setItem('workoutHistory', JSON.stringify(workoutHistoryData));
                
                // Vérifier les badges
                checkBadges();
                
                // Vérifier si la semaine est terminée
                checkWeekCompletion();
            }
            
            // Mettre à jour l'affichage
            loadProgress();
            displayTodayProgram();
            displayWeekProgram();
        }

        // Charger la progression
        function loadProgress() {
            const savedProgress = localStorage.getItem('completedExercises');
            if (savedProgress) {
                completedExercises = JSON.parse(savedProgress);
            }
        }

        // Charger les paramètres utilisateur
        function loadUserSettings() {
            const savedSettings = localStorage.getItem('userSettings');
            if (savedSettings) {
                userSettings = JSON.parse(savedSettings);
                
                // Appliquer les paramètres
                profileName.textContent = userSettings.name;
                weeklyGoal.value = userSettings.weeklyGoal;
                setTheme(userSettings.theme);
                remindersToggle.checked = userSettings.reminders;
                
                // Mettre à jour les boutons de thème
                themeButtons.forEach(btn => {
                    if (btn.getAttribute('data-theme') === userSettings.theme) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }

        // Sauvegarder les paramètres utilisateur
        function saveUserSettings() {
            localStorage.setItem('userSettings', JSON.stringify(userSettings));
        }

        // Charger les notes de la semaine
        function loadWeekNotes() {
            const weekKey = `week${currentWeekNumber}`;
            if (weekNotesData[weekKey]) {
                weekNotes.value = weekNotesData[weekKey];
            } else {
                weekNotes.value = '';
            }
        }

        // Sauvegarder les notes de la semaine
        function saveWeekNotes() {
            const weekKey = `week${currentWeekNumber}`;
            weekNotesData[weekKey] = weekNotes.value;
            localStorage.setItem('weekNotes', JSON.stringify(weekNotesData));
            alert("Notes sauvegardées !");
        }

        // Charger les photos de progression
        function loadProgressPhotos() {
            const savedPhotos = localStorage.getItem('progressPhotos');
            if (savedPhotos) {
                progressPhotosData = JSON.parse(savedPhotos);
            }
        }

        // Sauvegarder les photos de progression
        function saveProgressPhotos() {
            localStorage.setItem('progressPhotos', JSON.stringify(progressPhotosData));
        }

        // Afficher les photos de progression
        function displayProgressPhotos() {
            progressPhotos.innerHTML = '';
            
            if (progressPhotosData.length === 0) {
                progressPhotos.innerHTML = '<p style="text-align: center; color: var(--text-light);">Aucune photo de progression</p>';
                return;
            }
            
            progressPhotosData.forEach(photo => {
                const photoElement = document.createElement('div');
                photoElement.style.marginBottom = '15px';
                photoElement.innerHTML = `
                    <img src="${photo.data}" style="width: 100%; border-radius: 8px; margin-bottom: 5px;">
                    <div style="font-size: 0.8rem; color: var(--text-light); text-align: center;">
                        ${new Date(photo.date).toLocaleDateString('fr-FR')}
                    </div>
                `;
                progressPhotos.appendChild(photoElement);
            });
        }

        // Mettre à jour la progression du jour
        function updateDailyProgress() {
            const weekData = trainingProgram[currentWeekNumber];
            const totalExercises = weekData.morning.exercises.length + weekData.evening.exercises.length;
            let completedCount = 0;
            
            // Compter les exercices complétés pour aujourd'hui
            for (let i = 0; i < weekData.morning.exercises.length; i++) {
                const exerciseId = `week${currentWeekNumber}-morning-${i}`;
                if (completedExercises[exerciseId]) {
                    completedCount++;
                }
            }
            
            for (let i = 0; i < weekData.evening.exercises.length; i++) {
                const exerciseId = `week${currentWeekNumber}-evening-${i}`;
                if (completedExercises[exerciseId]) {
                    completedCount++;
                }
            }
            
            // Mettre à jour la barre de progression
            const progressPercentage = totalExercises > 0 ? (completedCount / totalExercises) * 100 : 0;
            dailyProgress.style.width = `${progressPercentage}%`;
        }

        // Mettre à jour la progression de la semaine
        function updateWeeklyProgress() {
            const totalExercises = Object.keys(completedExercises).length;
            const allPossibleExercises = calculateTotalExercises();
            const progressPercentage = allPossibleExercises > 0 ? (totalExercises / allPossibleExercises) * 100 : 0;
            weeklyProgress.style.width = `${progressPercentage}%`;
        }

        // Calculer le nombre total d'exercices possibles
        function calculateTotalExercises() {
            let total = 0;
            for (const week in trainingProgram) {
                total += trainingProgram[week].morning.exercises.length;
                total += trainingProgram[week].evening.exercises.length;
            }
            return total;
        }

        // Afficher les statistiques
        function displayStats() {
            // Calculer les statistiques
            const totalWorkouts = workoutHistoryData.length;
            const totalExercises = Object.keys(completedExercises).length;
            const currentStreak = calculateCurrentStreak();
            const completionRate = Math.round((totalExercises / calculateTotalExercises()) * 100);
            
            // Mettre à jour les éléments
            totalWorkoutsEl.textContent = totalWorkouts;
            totalExercisesEl.textContent = totalExercises;
            currentStreakEl.textContent = currentStreak;
            completionRateEl.textContent = `${completionRate}%`;
            
            // Mettre à jour le graphique
            updateProgressChart();
        }

        // Calculer la série actuelle
        function calculateCurrentStreak() {
            if (workoutHistoryData.length === 0) return 0;
            
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Vérifier les 30 derniers jours
            for (let i = 0; i < 30; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(today.getDate() - i);
                const dateStr = checkDate.toISOString().split('T')[0];
                
                const hasWorkout = workoutHistoryData.some(entry => {
                    const entryDate = new Date(entry.date).toISOString().split('T')[0];
                    return entryDate === dateStr;
                });
                
                if (hasWorkout) {
                    streak++;
                } else if (i === 0) {
                    // Aujourd'hui n'a pas d'entraînement, pas de série
                    return 0;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        // Mettre à jour le graphique de progression
        function updateProgressChart() {
            const ctx = progressChart.getContext('2d');
            
            // Préparer les données des 4 dernières semaines
            const labels = [];
            const data = [];
            
            for (let week = 1; week <= 4; week++) {
                labels.push(`Semaine ${week}`);
                
                let completed = 0;
                let total = 0;
                
                if (trainingProgram[week]) {
                    total = trainingProgram[week].morning.exercises.length + trainingProgram[week].evening.exercises.length;
                    
                    for (let i = 0; i < trainingProgram[week].morning.exercises.length; i++) {
                        const exerciseId = `week${week}-morning-${i}`;
                        if (completedExercises[exerciseId]) completed++;
                    }
                    
                    for (let i = 0; i < trainingProgram[week].evening.exercises.length; i++) {
                        const exerciseId = `week${week}-evening-${i}`;
                        if (completedExercises[exerciseId]) completed++;
                    }
                }
                
                const percentage = total > 0 ? (completed / total) * 100 : 0;
                data.push(percentage);
            }
            
            // Créer le graphique
            if (window.progressChartInstance) {
                window.progressChartInstance.destroy();
            }
            
            window.progressChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Progression (%)',
                        data: data,
                        backgroundColor: [
                            'rgba(74, 111, 165, 0.7)',
                            'rgba(107, 186, 167, 0.7)',
                            'rgba(255, 179, 71, 0.7)',
                            'rgba(255, 107, 107, 0.7)'
                        ],
                        borderColor: [
                            'rgb(74, 111, 165)',
                            'rgb(107, 186, 167)',
                            'rgb(255, 179, 71)',
                            'rgb(255, 107, 107)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Afficher les badges
        function displayBadges() {
            badgesContainer.innerHTML = '';
            
            badges.forEach(badge => {
                const isEarned = earnedBadges.includes(badge.id);
                
                const badgeElement = document.createElement('div');
                badgeElement.className = 'badge-item';
                badgeElement.innerHTML = `
                    <div class="badge-icon ${isEarned ? 'earned' : ''}">
                        <i class="fas ${badge.icon}"></i>
                    </div>
                    <div class="badge-name">${badge.name}</div>
                `;
                
                badgesContainer.appendChild(badgeElement);
            });
        }

        // Afficher l'historique des séances
        function displayWorkoutHistory() {
            workoutHistory.innerHTML = '';
            
            if (workoutHistoryData.length === 0) {
                workoutHistory.innerHTML = '<p style="text-align: center; color: var(--text-light);">Aucune séance enregistrée</p>';
                return;
            }
            
            // Afficher les 10 dernières séances
            const recentWorkouts = workoutHistoryData.slice(0, 10);
            
            recentWorkouts.forEach(workout => {
                const workoutDate = new Date(workout.date);
                const workoutElement = document.createElement('div');
                workoutElement.className = 'history-item';
                workoutElement.innerHTML = `
                    <div>
                        <div class="history-date">${workoutDate.toLocaleDateString('fr-FR')}</div>
                        <div class="history-session">${workout.type} - ${workoutDate.toLocaleTimeString('fr-FR', {hour: '2-digit', minute:'2-digit'})}</div>
                    </div>
                    <div>
                        <i class="fas fa-check" style="color: var(--success);"></i>
                    </div>
                `;
                workoutHistory.appendChild(workoutElement);
            });
        }

        // Vérifier les badges
        function checkBadges() {
            const newBadges = [];
            
            // Badge première séance
            if (workoutHistoryData.length >= 1 && !earnedBadges.includes('first_workout')) {
                newBadges.push('first_workout');
            }
            
            // Badge semaine terminée
            for (let week = 1; week <= 4; week++) {
                if (isWeekComplete(week) && !earnedBadges.includes(`week${week}_complete`)) {
                    newBadges.push('week_complete');
                    break;
                }
            }
            
            // Badge mois d'entraînement
            if (Object.keys(completedExercises).length >= 50 && !earnedBadges.includes('month_complete')) {
                newBadges.push('month_complete');
            }
            
            // Badge série de 7 jours
            if (calculateCurrentStreak() >= 7 && !earnedBadges.includes('streak_7')) {
                newBadges.push('streak_7');
            }
            
            // Badge série de 30 jours
            if (calculateCurrentStreak() >= 30 && !earnedBadges.includes('streak_30')) {
                newBadges.push('streak_30');
            }
            
            // Ajouter les nouveaux badges
            newBadges.forEach(badgeId => {
                if (!earnedBadges.includes(badgeId)) {
                    earnedBadges.push(badgeId);
                }
            });
            
            // Sauvegarder les badges
            localStorage.setItem('earnedBadges', JSON.stringify(earnedBadges));
            
            // Afficher une notification pour les nouveaux badges
            if (newBadges.length > 0) {
                displayBadges();
                alert(`Félicitations ! Vous avez débloqué ${newBadges.length} nouveau(x) badge(s) !`);
            }
        }

        // Vérifier si une semaine est terminée
        function checkWeekCompletion() {
            if (isWeekComplete(currentWeekNumber) && !completedExercises[`week${currentWeekNumber}_completed`]) {
                completedExercises[`week${currentWeekNumber}_completed`] = true;
                localStorage.setItem('completedExercises', JSON.stringify(completedExercises));
                
                // Afficher l'écran de félicitations
                celebrationMessage.textContent = `Vous avez terminé la semaine ${currentWeekNumber} !`;
                celebration.classList.add('active');
            }
        }

        // Vérifier si une semaine est complète
        function isWeekComplete(week) {
            const weekData = trainingProgram[week];
            if (!weekData) return false;
            
            const totalExercises = weekData.morning.exercises.length + weekData.evening.exercises.length;
            let completedCount = 0;
            
            for (let i = 0; i < weekData.morning.exercises.length; i++) {
                const exerciseId = `week${week}-morning-${i}`;
                if (completedExercises[exerciseId]) completedCount++;
            }
            
            for (let i = 0; i < weekData.evening.exercises.length; i++) {
                const exerciseId = `week${week}-evening-${i}`;
                if (completedExercises[exerciseId]) completedCount++;
            }
            
            return completedCount === totalExercises;
        }

        // Fermer l'écran de félicitations
        function closeCelebration() {
            celebration.classList.remove('active');
        }

        // Définir le thème
        function setTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('theme-dark');
            } else {
                document.body.classList.remove('theme-dark');
            }
            
            userSettings.theme = theme;
            saveUserSettings();
        }

        // Configurer les rappels
        function setupReminders() {
            if (!("Notification" in window)) {
                alert("Votre navigateur ne supporte pas les notifications");
                return;
            }
            
            if (Notification.permission === "default") {
                Notification.requestPermission();
            }
            
            // Planifier les rappels (simplifié)
            alert("Rappels activés ! Vous recevrez des notifications pour vos séances du matin et du soir.");
        }

        // Exporter les données
        function exportData() {
            const data = {
                completedExercises: completedExercises,
                workoutHistory: workoutHistoryData,
                earnedBadges: earnedBadges,
                userSettings: userSettings,
                weekNotes: weekNotesData,
                progressPhotos: progressPhotosData.length,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fitprogress-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert("Données exportées avec succès !");
        }

        // Charger la musique
        function loadMusic(index) {
            if (musicFiles.length === 0) return;
            
            const file = musicFiles[index];
            const url = URL.createObjectURL(file);
            audioPlayer.src = url;
            musicTitle.textContent = file.name;
            musicArtist.textContent = "Fichier local";
        }

        // Basculer la lecture de la musique
        function toggleMusic() {
            if (musicFiles.length === 0) {
                alert("Veuillez d'abord importer de la musique");
                return;
            }
            
            if (isPlaying) {
                audioPlayer.pause();
                playMusicBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                audioPlayer.play();
                playMusicBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
            
            isPlaying = !isPlaying;
        }

        // Musique précédente
        function prevMusic() {
            if (musicFiles.length === 0) return;
            
            currentMusicIndex = (currentMusicIndex - 1 + musicFiles.length) % musicFiles.length;
            loadMusic(currentMusicIndex);
            
            if (isPlaying) {
                audioPlayer.play();
            }
        }

        // Musique suivante
        function nextMusic() {
            if (musicFiles.length === 0) return;
            
            currentMusicIndex = (currentMusicIndex + 1) % musicFiles.length;
            loadMusic(currentMusicIndex);
            
            if (isPlaying) {
                audioPlayer.play();
            }
        }

        // Mettre à jour le niveau de l'utilisateur
        function updateUserLevel() {
            const totalExercises = Object.keys(completedExercises).length;
            let level = 1;
            let levelName = "Débutant";
            
            if (totalExercises >= 100) {
                level = 4;
                levelName = "Expert";
            } else if (totalExercises >= 50) {
                level = 3;
                levelName = "Intermédiaire";
            } else if (totalExercises >= 20) {
                level = 2;
                levelName = "Confirmé";
            }
            
            profileLevel.textContent = `Niveau ${level} - ${levelName}`;
        }
    </script>
</body>
</html>
