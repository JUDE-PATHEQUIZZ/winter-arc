<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitProgress - Programme d'entraînement</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4a6fa5;
            --primary-light: #6b8cbc;
            --secondary: #6bbaa7;
            --background: #f9f9f9;
            --card-bg: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --border: #e0e0e0;
            --success: #6bbaa7;
            --warning: #ffb347;
            --danger: #ff6b6b;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
        }

        .theme-dark {
            --primary: #6b8cbc;
            --primary-light: #8ba7d4;
            --secondary: #7bc9b5;
            --background: #1a1a1a;
            --card-bg: #2d2d2d;
            --text: #f0f0f0;
            --text-light: #b0b0b0;
            --border: #444444;
            --success: #7bc9b5;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .theme-blue {
            --primary: #3a7bd5;
            --primary-light: #5a9bff;
            --secondary: #00d2ff;
            --background: #f0f8ff;
            --card-bg: #ffffff;
            --text: #1a3c6e;
            --text-light: #4a6fa5;
            --border: #c2e0ff;
            --success: #00d2ff;
            --shadow: 0 4px 12px rgba(58, 123, 213, 0.15);
        }

        .theme-green {
            --primary: #2e8b57;
            --primary-light: #3cb371;
            --secondary: #9acd32;
            --background: #f0fff0;
            --card-bg: #ffffff;
            --text: #1e5631;
            --text-light: #4a7c59;
            --border: #c8e6c9;
            --success: #2e8b57;
            --shadow: 0 4px 12px rgba(46, 139, 87, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.4rem;
            color: var(--primary);
        }

        .logo i {
            font-size: 1.6rem;
        }

        nav {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 5px 0;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
            white-space: nowrap;
        }

        .nav-btn.active {
            background-color: var(--primary);
            color: white;
        }

        .nav-btn:hover:not(.active) {
            background-color: rgba(74, 111, 165, 0.1);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .card-title i {
            font-size: 1.1rem;
        }

        .motivation {
            text-align: center;
            font-style: italic;
            color: var(--text-light);
            padding: 15px;
            background-color: rgba(107, 186, 167, 0.1);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .session {
            margin-bottom: 25px;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .session-title {
            font-weight: 600;
            color: var(--primary);
        }

        .session-duration {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .exercise {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .exercise:last-child {
            border-bottom: none;
        }

        .exercise.completed {
            background-color: rgba(107, 186, 167, 0.05);
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .exercise-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(74, 111, 165, 0.1);
            border-radius: 50%;
            margin-right: 15px;
            color: var(--primary);
        }

        .exercise-details {
            flex: 1;
        }

        .exercise-name {
            font-weight: 500;
        }

        .exercise-reps {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .exercise-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .timer-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .timer-btn:hover {
            color: var(--primary-light);
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .checkbox.checked {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
            transform: scale(1.1);
        }

        .week-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .week-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .week-btn:hover:not(:disabled) {
            background-color: rgba(74, 111, 165, 0.1);
        }

        .week-btn:disabled {
            color: var(--text-light);
            cursor: not-allowed;
        }

        .week-title {
            text-align: center;
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--border);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--success);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }

        .settings-option:last-child {
            border-bottom: none;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-light);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #ff5252;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #5aa895;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
        }

        .timer-display {
            font-size: 3rem;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            color: var(--primary);
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .badge-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
        }

        .badge-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 8px;
        }

        .badge-icon.earned {
            background-color: var(--warning);
        }

        .badge-name {
            font-size: 0.8rem;
            text-align: center;
        }

        .music-player {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
        }

        .music-controls {
            display: flex;
            gap: 10px;
        }

        .music-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .music-info {
            flex: 1;
        }

        .music-title {
            font-weight: 500;
        }

        .music-artist {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 8px 15px;
            background-color: var(--primary);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            background-color: var(--primary-light);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .profile-level {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--border);
            cursor: pointer;
        }

        .theme-btn.active {
            border-color: var(--primary);
        }

        .theme-light {
            background: linear-gradient(135deg, #f9f9f9 50%, #4a6fa5 50%);
        }

        .theme-dark {
            background: linear-gradient(135deg, #2d2d2d 50%, #6b8cbc 50%);
        }

        .theme-blue {
            background: linear-gradient(135deg, #f0f8ff 50%, #3a7bd5 50%);
        }

        .theme-green {
            background: linear-gradient(135deg, #f0fff0 50%, #2e8b57 50%);
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            flex-direction: column;
            color: white;
            text-align: center;
        }

        .celebration.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        .celebration h1 {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .celebration p {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .note-textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            color: var(--text);
            resize: vertical;
            margin-bottom: 15px;
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            font-weight: 500;
        }

        .history-session {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .spotify-player {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .spotify-login {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
            padding: 20px;
            background-color: rgba(30, 215, 96, 0.1);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .spotify-btn {
            background-color: #1DB954;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .spotify-btn:hover {
            background-color: #1ed760;
        }

        .spotify-track {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .track-cover {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        .track-info {
            flex: 1;
        }

        .track-name {
            font-weight: 500;
        }

        .track-artist {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .nutrition-card {
            background-color: rgba(107, 186, 167, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .nutrition-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
        }

        .nutrition-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .community-post {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .community-post:last-child {
            border-bottom: none;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        .post-user {
            font-weight: 500;
        }

        .post-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .post-content {
            margin-bottom: 10px;
        }

        .post-actions {
            display: flex;
            gap: 15px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .post-action i {
            font-size: 1rem;
        }

        .advanced-settings {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .setting-group {
            margin-bottom: 15px;
        }

        .setting-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .setting-input {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            color: var(--text);
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .progress-item:last-child {
            border-bottom: none;
        }

        .progress-date {
            font-weight: 500;
        }

        .progress-value {
            color: var(--success);
            font-weight: bold;
        }

        /* Mini-jeux */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .game-card {
            background-color: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .game-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .game-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .game-desc {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Traducteur */
        .translator-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .language-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .lang-btn {
            padding: 8px 15px;
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lang-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .translation-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .translation-input, .translation-output {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            color: var(--text);
            resize: vertical;
            min-height: 100px;
        }

        .translation-output {
            background-color: rgba(107, 186, 167, 0.1);
        }

        /* Jeu de mémoire */
        .memory-game {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .memory-card {
            aspect-ratio: 1;
            background-color: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }

        .memory-card.flipped {
            background-color: var(--secondary);
            transform: rotateY(180deg);
        }

        .memory-card.matched {
            background-color: var(--success);
            cursor: default;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        /* Restauration de sauvegarde */
        .restore-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .backup-info {
            background-color: rgba(255, 179, 71, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            nav {
                width: 100%;
                justify-content: flex-start;
            }
            
            .nav-btn {
                flex: none;
                text-align: center;
                font-size: 0.8rem;
                padding: 8px 10px;
            }
            
            .stats-grid, .nutrition-grid, .games-grid {
                grid-template-columns: 1fr;
            }
            
            .timer-display {
                font-size: 2.5rem;
            }
            
            .memory-game {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            .timer-modal .modal-content {
                max-width: 90%;
                padding: 15px;
            }
            
            .timer-display {
                font-size: 2.5rem;
                margin: 10px 0;
            }
        }

        /* Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-dumbbell"></i>
                <span>FitProgress</span>
            </div>
            <nav>
                <button class="nav-btn active" data-page="home">
                    <i class="fas fa-home"></i>
                    <span class="nav-text">Aujourd'hui</span>
                </button>
                <button class="nav-btn" data-page="week">
                    <i class="fas fa-calendar-week"></i>
                    <span class="nav-text">Semaine</span>
                </button>
                <button class="nav-btn" data-page="stats">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-text">Stats</span>
                </button>
                <button class="nav-btn" data-page="nutrition">
                    <i class="fas fa-apple-alt"></i>
                    <span class="nav-text">Nutrition</span>
                </button>
                <button class="nav-btn" data-page="games">
                    <i class="fas fa-gamepad"></i>
                    <span class="nav-text">Jeux</span>
                </button>
                <button class="nav-btn" data-page="translator">
                    <i class="fas fa-language"></i>
                    <span class="nav-text">Traducteur</span>
                </button>
                <button class="nav-btn" data-page="community">
                    <i class="fas fa-users"></i>
                    <span class="nav-text">Communauté</span>
                </button>
                <button class="nav-btn" data-page="profile">
                    <i class="fas fa-user"></i>
                    <span class="nav-text">Profil</span>
                </button>
            </nav>
        </header>

        <!-- Page d'accueil (Aujourd'hui) -->
        <div id="home" class="page active">
            <div class="motivation" id="daily-motivation">
                <!-- La phrase motivante sera insérée ici par JavaScript -->
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-calendar-day"></i>
                    <span>Programme du jour</span>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="daily-progress"></div>
                </div>
                
                <div class="session">
                    <div class="session-header">
                        <div class="session-title">Matin</div>
                        <div class="session-duration" id="morning-duration">5 min</div>
                    </div>
                    <div id="morning-exercises">
                        <!-- Les exercices du matin seront insérés ici par JavaScript -->
                    </div>
                </div>
                
                <div class="session">
                    <div class="session-header">
                        <div class="session-title">Soir</div>
                        <div class="session-duration" id="evening-duration">12-15 min</div>
                    </div>
                    <div id="evening-exercises">
                        <!-- Les exercices du soir seront insérés ici par JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Lecteur de musique -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-music"></i>
                    <span>Musique d'entraînement</span>
                </div>
                
                <!-- Intégration Spotify -->
                <div class="spotify-player">
                    <div class="spotify-login" id="spotify-login">
                        <p>Connectez-vous à Spotify pour écouter votre musique pendant l'entraînement</p>
                        <button class="spotify-btn" id="connect-spotify">
                            <i class="fab fa-spotify"></i> Se connecter à Spotify
                        </button>
                    </div>
                    
                    <div id="spotify-player" style="display: none;">
                        <div class="spotify-track">
                            <img id="track-cover" src="" class="track-cover" alt="Cover">
                            <div class="track-info">
                                <div class="track-name" id="track-name">Titre de la musique</div>
                                <div class="track-artist" id="track-artist">Artiste</div>
                            </div>
                        </div>
                        <div class="music-controls">
                            <button class="music-btn" id="prev-track">
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button class="music-btn" id="play-track">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="music-btn" id="next-track">
                                <i class="fas fa-step-forward"></i>
                            </button>
                            <button class="music-btn" id="shuffle-track">
                                <i class="fas fa-random"></i>
                            </button>
                        </div>
                        <div class="progress-bar" style="margin: 10px 0;">
                            <div class="progress-fill" id="track-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Lecteur de musique local (fallback) -->
                <div class="music-player" id="local-music-player">
                    <div class="music-info">
                        <div class="music-title" id="music-title">Aucune musique sélectionnée</div>
                        <div class="music-artist" id="music-artist">Importer votre musique</div>
                    </div>
                    <div class="music-controls">
                        <button class="music-btn" id="prev-music">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="music-btn" id="play-music">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="music-btn" id="next-music">
                            <i class="fas fa-step-forward"></i>
                        </button>
                    </div>
                </div>
                <input type="file" id="music-file" class="file-input" accept="audio/*" multiple>
                <label for="music-file" class="file-label">
                    <i class="fas fa-upload"></i> Importer de la musique
                </label>
            </div>
        </div>

        <!-- Page de la semaine -->
        <div id="week" class="page">
            <div class="week-selector">
                <button class="week-btn" id="prev-week">
                    <i class="fas fa-chevron-left"></i> Semaine précédente
                </button>
                <div class="week-title" id="current-week">Semaine 1</div>
                <button class="week-btn" id="next-week">
                    Semaine suivante <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-calendar-week"></i>
                    <span>Programme de la semaine</span>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="weekly-progress"></div>
                </div>
                
                <div id="week-exercises">
                    <!-- Le programme de la semaine sera inséré ici par JavaScript -->
                </div>
            </div>

            <!-- Notes personnelles -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-sticky-note"></i>
                    <span>Notes de la semaine</span>
                </div>
                <textarea class="note-textarea" id="week-notes" placeholder="Ajoutez vos notes personnelles pour cette semaine..."></textarea>
                <button class="btn btn-primary" id="save-notes">
                    <i class="fas fa-save"></i> Enregistrer les notes
                </button>
            </div>
        </div>

        <!-- Page des statistiques -->
        <div id="stats" class="page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    <span>Statistiques de progression</span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-workouts">0</div>
                        <div class="stat-label">Séances complétées</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-exercises">0</div>
                        <div class="stat-label">Exercices terminés</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="current-streak">0</div>
                        <div class="stat-label">Jours consécutifs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completion-rate">0%</div>
                        <div class="stat-label">Taux de complétion</div>
                    </div>
                </div>
                
                <canvas id="progress-chart" height="250"></canvas>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-trophy"></i>
                    <span>Badges et récompenses</span>
                </div>
                
                <div class="badge-container" id="badges-container">
                    <!-- Les badges seront insérés ici par JavaScript -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    <span>Historique des séances</span>
                </div>
                
                <div id="workout-history">
                    <!-- L'historique sera inséré ici par JavaScript -->
                </div>
            </div>
        </div>

        <!-- Page de nutrition -->
        <div id="nutrition" class="page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-apple-alt"></i>
                    <span>Suivi nutritionnel</span>
                </div>
                
                <div class="nutrition-grid">
                    <div class="nutrition-card">
                        <div class="nutrition-value" id="calories-consumed">0</div>
                        <div class="nutrition-label">Calories consommées</div>
                    </div>
                    <div class="nutrition-card">
                        <div class="nutrition-value" id="calories-burned">0</div>
                        <div class="nutrition-label">Calories brûlées</div>
                    </div>
                    <div class="nutrition-card">
                        <div class="nutrition-value" id="protein-intake">0g</div>
                        <div class="nutrition-label">Protéines</div>
                    </div>
                    <div class="nutrition-card">
                        <div class="nutrition-value" id="water-intake">0L</div>
                        <div class="nutrition-label">Eau</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="add-nutrition">
                    <i class="fas fa-plus"></i> Ajouter une entrée nutritionnelle
                </button>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-utensils"></i>
                    <span>Repas de la journée</span>
                </div>
                
                <div id="meals-list">
                    <!-- Les repas seront insérés ici par JavaScript -->
                </div>
                
                <button class="btn btn-primary" id="add-meal" style="margin-top: 15px;">
                    <i class="fas fa-plus"></i> Ajouter un repas
                </button>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-book"></i>
                    <span>Conseils nutritionnels</span>
                </div>
                
                <div id="nutrition-tips">
                    <!-- Les conseils seront insérés ici par JavaScript -->
                </div>
            </div>
        </div>

        <!-- Page des jeux -->
        <div id="games" class="page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-gamepad"></i>
                    <span>Mini-jeux</span>
                </div>
                
                <div class="games-grid">
                    <div class="game-card" id="memory-game-btn">
                        <div class="game-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="game-name">Mémoire</div>
                        <div class="game-desc">Testez votre mémoire avec ce jeu de cartes</div>
                    </div>
                    
                    <div class="game-card" id="reaction-game-btn">
                        <div class="game-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="game-name">Réaction</div>
                        <div class="game-desc">Testez votre temps de réaction</div>
                    </div>
                    
                    <div class="game-card" id="math-game-btn">
                        <div class="game-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="game-name">Calcul mental</div>
                        <div class="game-desc">Améliorez vos compétences en calcul</div>
                    </div>
                    
                    <div class="game-card" id="word-game-btn">
                        <div class="game-icon">
                            <i class="fas fa-font"></i>
                        </div>
                        <div class="game-name">Mots mêlés</div>
                        <div class="game-desc">Trouvez des mots dans une grille</div>
                    </div>
                </div>
            </div>
            
            <!-- Jeu de mémoire -->
            <div class="card" id="memory-game-container" style="display: none;">
                <div class="card-title">
                    <i class="fas fa-brain"></i>
                    <span>Jeu de mémoire</span>
                </div>
                
                <div class="game-stats">
                    <div>Coups: <span id="memory-moves">0</span></div>
                    <div>Temps: <span id="memory-time">0s</span></div>
                    <div>Score: <span id="memory-score">0</span></div>
                </div>
                
                <div class="memory-game" id="memory-game-board">
                    <!-- Les cartes seront générées par JavaScript -->
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-primary" id="memory-restart">
                        <i class="fas fa-redo"></i> Recommencer
                    </button>
                    <button class="btn btn-danger" id="memory-back">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                </div>
            </div>
            
            <!-- Jeu de réaction -->
            <div class="card" id="reaction-game-container" style="display: none;">
                <div class="card-title">
                    <i class="fas fa-bolt"></i>
                    <span>Test de réaction</span>
                </div>
                
                <div style="text-align: center; padding: 40px 0;">
                    <div id="reaction-instruction" style="font-size: 1.2rem; margin-bottom: 20px;">
                        Cliquez quand le carré devient vert
                    </div>
                    <div id="reaction-box" style="width: 200px; height: 200px; background-color: var(--primary); margin: 0 auto; border-radius: 8px; cursor: pointer;"></div>
                    <div style="margin-top: 20px;">
                        <div>Temps de réaction: <span id="reaction-time">-</span> ms</div>
                        <div>Meilleur score: <span id="best-reaction">-</span> ms</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-primary" id="reaction-start">
                        <i class="fas fa-play"></i> Commencer
                    </button>
                    <button class="btn btn-danger" id="reaction-back">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                </div>
            </div>
        </div>

        <!-- Page du traducteur -->
        <div id="translator" class="page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-language"></i>
                    <span>Traducteur</span>
                </div>
                
                <div class="translator-container">
                    <div class="language-selector">
                        <button class="lang-btn active" data-lang="fr">Français</button>
                        <button class="lang-btn" data-lang="en">English</button>
                        <button class="lang-btn" data-lang="sw">Kiswahili</button>
                        <button class="lang-btn" data-lang="es">Español</button>
                    </div>
                    
                    <div class="translation-area">
                        <textarea class="translation-input" id="translation-input" placeholder="Tapez votre texte ici..."></textarea>
                        <button class="btn btn-primary" id="translate-btn">
                            <i class="fas fa-exchange-alt"></i> Traduire
                        </button>
                        <textarea class="translation-output" id="translation-output" placeholder="Traduction apparaîtra ici..." readonly></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" id="speak-input">
                            <i class="fas fa-volume-up"></i> Écouter
                        </button>
                        <button class="btn btn-success" id="speak-output">
                            <i class="fas fa-volume-up"></i> Écouter
                        </button>
                        <button class="btn btn-primary" id="copy-output">
                            <i class="fas fa-copy"></i> Copier
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    <span>Historique des traductions</span>
                </div>
                
                <div id="translation-history">
                    <!-- L'historique des traductions sera inséré ici par JavaScript -->
                </div>
            </div>
        </div>

        <!-- Page de communauté -->
        <div id="community" class="page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-users"></i>
                    <span>Communauté FitProgress</span>
                </div>
                
                <div id="community-posts">
                    <!-- Les posts de la communauté seront insérés ici par JavaScript -->
                </div>
                
                <div class="community-post" style="border: 1px solid var(--border); border-radius: 8px; margin-top: 15px;">
                    <textarea class="note-textarea" id="new-post" placeholder="Partagez votre progression, posez une question ou encouragez les autres..."></textarea>
                    <button class="btn btn-primary" id="publish-post">
                        <i class="fas fa-paper-plane"></i> Publier
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-trophy"></i>
                    <span>Classement de la communauté</span>
                </div>
                
                <div id="community-ranking">
                    <!-- Le classement sera inséré ici par JavaScript -->
                </div>
            </div>
        </div>

        <!-- Page du profil -->
        <div id="profile" class="page">
            <div class="card">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-info">
                        <div class="profile-name" id="profile-name">Athlète</div>
                        <div class="profile-level" id="profile-level">Niveau 1 - Débutant</div>
                        <div class="profile-points" id="profile-points">0 points</div>
                    </div>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div>Objectif hebdomadaire</div>
                        <div class="text-light">Nombre de séances par semaine</div>
                    </div>
                    <select id="weekly-goal">
                        <option value="3">3 séances</option>
                        <option value="4">4 séances</option>
                        <option value="5">5 séances</option>
                        <option value="6">6 séances</option>
                        <option value="7">7 séances</option>
                    </select>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div>Thème de l'application</div>
                        <div class="text-light">Choisissez l'apparence</div>
                    </div>
                    <div class="theme-selector">
                        <button class="theme-btn theme-light active" data-theme="light"></button>
                        <button class="theme-btn theme-dark" data-theme="dark"></button>
                        <button class="theme-btn theme-blue" data-theme="blue"></button>
                        <button class="theme-btn theme-green" data-theme="green"></button>
                    </div>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div>Activer les rappels</div>
                        <div class="text-light">Notifications matin et soir</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="reminders-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-camera"></i>
                    <span>Photos de progression</span>
                </div>
                <div id="progress-photos">
                    <!-- Les photos de progression seront insérées ici par JavaScript -->
                </div>
                <input type="file" id="photo-upload" class="file-input" accept="image/*" capture="camera">
                <label for="photo-upload" class="file-label" style="margin-top: 15px;">
                    <i class="fas fa-camera"></i> Ajouter une photo
                </label>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-sliders-h"></i>
                    <span>Paramètres avancés</span>
                </div>
                
                <div class="advanced-settings">
                    <div class="setting-group">
                        <label class="setting-label">Nom d'utilisateur</label>
                        <input type="text" class="setting-input" id="username-input" placeholder="Votre nom d'utilisateur">
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">Objectif de poids (kg)</label>
                        <input type="number" class="setting-input" id="weight-goal" placeholder="Votre objectif de poids">
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">Objectif de durée d'entraînement (min/jour)</label>
                        <input type="number" class="setting-input" id="workout-duration-goal" placeholder="Durée d'entraînement quotidienne">
                    </div>
                    
                    <button class="btn btn-primary" id="save-advanced-settings">
                        <i class="fas fa-save"></i> Sauvegarder les paramètres
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-download"></i>
                    <span>Sauvegarde et restauration</span>
                </div>
                
                <div class="backup-info">
                    <p><strong>Conseil de sauvegarde:</strong> Exportez régulièrement vos données pour ne pas perdre votre progression.</p>
                </div>
                
                <div class="restore-section">
                    <button class="btn btn-primary" id="export-data">
                        <i class="fas fa-file-export"></i> Exporter mes données
                    </button>
                    
                    <input type="file" id="import-file" class="file-input" accept=".json">
                    <label for="import-file" class="file-label">
                        <i class="fas fa-file-import"></i> Importer une sauvegarde
                    </label>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Zone de danger</span>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div>Réinitialiser la progression</div>
                        <div class="text-light">Efface toutes vos données sauvegardées</div>
                    </div>
                    <button class="btn btn-danger" id="reset-progress">Réinitialiser</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal du timer -->
    <div class="modal timer-modal" id="timer-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="timer-exercise-name">Exercice</h3>
                <button class="close-modal" id="close-timer">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="timer-display" id="timer-display">00:30</div>
            <div class="timer-controls">
                <button class="btn btn-primary" id="start-timer">
                    <i class="fas fa-play"></i> Démarrer
                </button>
                <button class="btn btn-danger" id="stop-timer" style="display: none;">
                    <i class="fas fa-stop"></i> Arrêter
                </button>
                <button class="btn btn-success" id="complete-exercise">
                    <i class="fas fa-check"></i> Terminer
                </button>
            </div>
        </div>
    </div>

    <!-- Écran de félicitations -->
    <div class="celebration" id="celebration">
        <h1>Félicitations !</h1>
        <p id="celebration-message">Vous avez terminé la semaine 1 !</p>
        <button class="btn btn-success" id="close-celebration">
            Continuer
        </button>
    </div>

    <!-- Audio pour les sons de feedback -->
    <audio id="complete-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    <audio id="timer-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>

    <script>
        // Données du programme d'entraînement
        const trainingProgram = {
            1: {
                title: "Semaine 1 : Activation + bases",
                morning: {
                    duration: "5 min",
                    exercises: [
                        { name: "Pompes", reps: "12", icon: "fa-hand-rock", duration: 30 },
                        { name: "Dips sur chaise", reps: "10", icon: "fa-chair", duration: 30 },
                        { name: "Gainage", reps: "20 sec", icon: "fa-stopwatch", duration: 20 },
                        { name: "Shoulder taps", reps: "15", icon: "fa-hands", duration: 30 }
                    ]
                },
                evening: {
                    duration: "12-15 min",
                    exercises: [
                        { name: "Pompes", reps: "4×12", icon: "fa-hand-rock", duration: 45 },
                        { name: "Dips", reps: "3×10", icon: "fa-chair", duration: 40 },
                        { name: "Gainage", reps: "3×25 sec", icon: "fa-stopwatch", duration: 25 },
                        { name: "Pompes diamant", reps: "3×15", icon: "fa-hands", duration: 40 }
                    ]
                }
            },
            2: {
                title: "Semaine 2 : Volume + forme",
                morning: {
                    duration: "5 min",
                    exercises: [
                        { name: "Pompes", reps: "15", icon: "fa-hand-rock", duration: 35 },
                        { name: "Dips", reps: "15", icon: "fa-chair", duration: 35 },
                        { name: "Gainage", reps: "30 sec", icon: "fa-stopwatch", duration: 30 },
                        { name: "Shoulder taps", reps: "20", icon: "fa-hands", duration: 35 }
                    ]
                },
                evening: {
                    duration: "15-20 min",
                    exercises: [
                        { name: "Pompes classiques", reps: "4×15", icon: "fa-hand-rock", duration: 50 },
                        { name: "Pompes diamant", reps: "4×12", icon: "fa-hands", duration: 45 },
                        { name: "Dips lents", reps: "4×12", icon: "fa-chair", duration: 40 },
                        { name: "Gainage", reps: "3×30 sec", icon: "fa-stopwatch", duration: 30 },
                        { name: "Pompes écartées", reps: "3×12", icon: "fa-hands", duration: 40 }
                    ]
                }
            },
            3: {
                title: "Semaine 3 : Hypertrophie maison",
                morning: {
                    duration: "5 min",
                    exercises: [
                        { name: "Pompes", reps: "20", icon: "fa-hand-rock", duration: 40 },
                        { name: "Dips", reps: "15", icon: "fa-chair", duration: 35 },
                        { name: "Gainage", reps: "40 sec", icon: "fa-stopwatch", duration: 40 },
                        { name: "Shoulder taps", reps: "20", icon: "fa-hands", duration: 35 }
                    ]
                },
                evening: {
                    duration: "20-25 min",
                    exercises: [
                        { name: "Pompes", reps: "5×15-20", icon: "fa-hand-rock", duration: 60 },
                        { name: "Dips", reps: "5×15", icon: "fa-chair", duration: 50 },
                        { name: "Pompes diamant", reps: "4×20", icon: "fa-hands", duration: 45 },
                        { name: "Pompes écartées", reps: "4×15", icon: "fa-hands", duration: 40 },
                        { name: "Gainage", reps: "4×45 sec", icon: "fa-stopwatch", duration: 45 }
                    ]
                }
            },
            4: {
                title: "Semaine 4 : Explosion du haut du corps",
                morning: {
                    duration: "5 min",
                    exercises: [
                        { name: "Pompes", reps: "25", icon: "fa-hand-rock", duration: 45 },
                        { name: "Dips", reps: "20", icon: "fa-chair", duration: 40 },
                        { name: "Gainage", reps: "1 min", icon: "fa-stopwatch", duration: 60 },
                        { name: "Shoulder taps", reps: "25", icon: "fa-hands", duration: 40 }
                    ]
                },
                evening: {
                    duration: "25-30 min",
                    exercises: [
                        { name: "Pompes", reps: "5×20-25", icon: "fa-hand-rock", duration: 70 },
                        { name: "Dips", reps: "5×20", icon: "fa-chair", duration: 60 },
                        { name: "Pompes diamant", reps: "5×20", icon: "fa-hands", duration: 50 },
                        { name: "Pompes écartées", reps: "5×15", icon: "fa-hands", duration: 45 },
                        { name: "Gainage", reps: "5×1 min", icon: "fa-stopwatch", duration: 60 },
                        { name: "Pompes max", reps: "3×30-40 reps", icon: "fa-fire", duration: 90 }
                    ]
                }
            }
        };

        // Phrases motivantes
        const motivationalPhrases = [
            "Chaque jour compte. Vous êtes plus fort que vous ne le pensez !",
            "La régularité est la clé du succès. Continuez comme ça !",
            "Votre corps peut supporter presque n'importe quoi. C'est votre esprit qu'il faut convaincre.",
            "Ne vous arrêtez pas quand vous avez mal. Arrêtez-vous quand vous avez terminé.",
            "Le succès est la somme de petits efforts répétés jour après jour.",
            "La seule mauvaise séance est celle que vous n'avez pas faite.",
            "Vous n'êtes pas obligé d'être extrême, juste cohérent.",
            "Le corps atteint ce que l'esprit croit.",
            "La discipline, c'est choisir entre ce que vous voulez maintenant et ce que vous voulez le plus.",
            "Ne rêvez pas de réussir. Travaillez pour y parvenir."
        ];

        // Badges disponibles
        const badges = [
            { id: "first_workout", name: "Première séance", icon: "fa-star", description: "Complétez votre première séance" },
            { id: "week_complete", name: "Semaine terminée", icon: "fa-calendar-check", description: "Terminez une semaine complète" },
            { id: "month_complete", name: "Mois d'entraînement", icon: "fa-trophy", description: "4 semaines d'entraînement" },
            { id: "streak_7", name: "7 jours consécutifs", icon: "fa-fire", description: "7 jours d'entraînement sans interruption" },
            { id: "streak_30", name: "30 jours consécutifs", icon: "fa-bolt", description: "30 jours d'entraînement sans interruption" },
            { id: "early_bird", name: "Lève-tôt", icon: "fa-sun", description: "5 séances du matin complétées" },
            { id: "night_owl", name: "Couche-tard", icon: "fa-moon", description: "5 séances du soir complétées" },
            { id: "perfectionist", name: "Perfectionniste", icon: "fa-gem", description: "100% des exercices d'une semaine complétés" }
        ];

        // Dictionnaire de traduction
        const translationDictionary = {
            'fr': {
                'hello': 'bonjour',
                'good morning': 'bonjour',
                'good evening': 'bonsoir',
                'how are you': 'comment allez-vous',
                'thank you': 'merci',
                'goodbye': 'au revoir',
                'please': 's\'il vous plaît',
                'yes': 'oui',
                'no': 'non',
                'water': 'eau',
                'food': 'nourriture',
                'exercise': 'exercice',
                'training': 'entraînement',
                'strong': 'fort',
                'health': 'santé',
                'energy': 'énergie',
                'motivation': 'motivation'
            },
            'en': {
                'bonjour': 'hello',
                'bonsoir': 'good evening',
                'comment allez-vous': 'how are you',
                'merci': 'thank you',
                'au revoir': 'goodbye',
                's\'il vous plaît': 'please',
                'oui': 'yes',
                'non': 'no',
                'eau': 'water',
                'nourriture': 'food',
                'exercice': 'exercise',
                'entraînement': 'training',
                'fort': 'strong',
                'santé': 'health',
                'énergie': 'energy',
                'motivation': 'motivation'
            },
            'sw': {
                'hello': 'hujambo',
                'good morning': 'habari za asubuhi',
                'good evening': 'habari za jioni',
                'how are you': 'habari yako',
                'thank you': 'asante',
                'goodbye': 'kwaheri',
                'please': 'tafadhali',
                'yes': 'ndiyo',
                'no': 'hapana',
                'water': 'maji',
                'food': 'chakula',
                'exercise': 'mazoezi',
                'training': 'mafunzo',
                'strong': 'imara',
                'health': 'afya',
                'energy': 'nishati',
                'motivation': 'motisha'
            },
            'es': {
                'hello': 'hola',
                'good morning': 'buenos días',
                'good evening': 'buenas tardes',
                'how are you': 'cómo estás',
                'thank you': 'gracias',
                'goodbye': 'adiós',
                'please': 'por favor',
                'yes': 'sí',
                'no': 'no',
                'water': 'agua',
                'food': 'comida',
                'exercise': 'ejercicio',
                'training': 'entrenamiento',
                'strong': 'fuerte',
                'health': 'salud',
                'energy': 'energía',
                'motivation': 'motivación'
            }
        };

        // Éléments DOM
        const pages = document.querySelectorAll('.page');
        const navButtons = document.querySelectorAll('.nav-btn');
        const dailyMotivation = document.getElementById('daily-motivation');
        const morningExercises = document.getElementById('morning-exercises');
        const eveningExercises = document.getElementById('evening-exercises');
        const morningDuration = document.getElementById('morning-duration');
        const eveningDuration = document.getElementById('evening-duration');
        const currentWeek = document.getElementById('current-week');
        const weekExercises = document.getElementById('week-exercises');
        const prevWeekBtn = document.getElementById('prev-week');
        const nextWeekBtn = document.getElementById('next-week');
        const dailyProgress = document.getElementById('daily-progress');
        const weeklyProgress = document.getElementById('weekly-progress');
        const resetProgressBtn = document.getElementById('reset-progress');
        const timerModal = document.getElementById('timer-modal');
        const timerDisplay = document.getElementById('timer-display');
        const timerExerciseName = document.getElementById('timer-exercise-name');
        const startTimerBtn = document.getElementById('start-timer');
        const stopTimerBtn = document.getElementById('stop-timer');
        const completeExerciseBtn = document.getElementById('complete-exercise');
        const closeTimerBtn = document.getElementById('close-timer');
        const celebration = document.getElementById('celebration');
        const celebrationMessage = document.getElementById('celebration-message');
        const closeCelebrationBtn = document.getElementById('close-celebration');
        const completeSound = document.getElementById('complete-sound');
        const timerSound = document.getElementById('timer-sound');
        const totalWorkoutsEl = document.getElementById('total-workouts');
        const totalExercisesEl = document.getElementById('total-exercises');
        const currentStreakEl = document.getElementById('current-streak');
        const completionRateEl = document.getElementById('completion-rate');
        const badgesContainer = document.getElementById('badges-container');
        const workoutHistory = document.getElementById('workout-history');
        const progressChart = document.getElementById('progress-chart');
        const profileName = document.getElementById('profile-name');
        const profileLevel = document.getElementById('profile-level');
        const profilePoints = document.getElementById('profile-points');
        const weeklyGoal = document.getElementById('weekly-goal');
        const themeButtons = document.querySelectorAll('.theme-btn');
        const remindersToggle = document.getElementById('reminders-toggle');
        const progressPhotos = document.getElementById('progress-photos');
        const photoUpload = document.getElementById('photo-upload');
        const exportDataBtn = document.getElementById('export-data');
        const importFile = document.getElementById('import-file');
        const weekNotes = document.getElementById('week-notes');
        const saveNotesBtn = document.getElementById('save-notes');
        const musicFile = document.getElementById('music-file');
        const musicTitle = document.getElementById('music-title');
        const musicArtist = document.getElementById('music-artist');
        const playMusicBtn = document.getElementById('play-music');
        const prevMusicBtn = document.getElementById('prev-music');
        const nextMusicBtn = document.getElementById('next-music');
        const connectSpotifyBtn = document.getElementById('connect-spotify');
        const spotifyLogin = document.getElementById('spotify-login');
        const spotifyPlayer = document.getElementById('spotify-player');
        const trackCover = document.getElementById('track-cover');
        const trackName = document.getElementById('track-name');
        const trackArtist = document.getElementById('track-artist');
        const playTrackBtn = document.getElementById('play-track');
        const prevTrackBtn = document.getElementById('prev-track');
        const nextTrackBtn = document.getElementById('next-track');
        const shuffleTrackBtn = document.getElementById('shuffle-track');
        const trackProgress = document.getElementById('track-progress');
        const caloriesConsumed = document.getElementById('calories-consumed');
        const caloriesBurned = document.getElementById('calories-burned');
        const proteinIntake = document.getElementById('protein-intake');
        const waterIntake = document.getElementById('water-intake');
        const addNutritionBtn = document.getElementById('add-nutrition');
        const mealsList = document.getElementById('meals-list');
        const addMealBtn = document.getElementById('add-meal');
        const nutritionTips = document.getElementById('nutrition-tips');
        const communityPosts = document.getElementById('community-posts');
        const newPost = document.getElementById('new-post');
        const publishPostBtn = document.getElementById('publish-post');
        const communityRanking = document.getElementById('community-ranking');
        const usernameInput = document.getElementById('username-input');
        const weightGoal = document.getElementById('weight-goal');
        const workoutDurationGoal = document.getElementById('workout-duration-goal');
        const saveAdvancedSettingsBtn = document.getElementById('save-advanced-settings');
        const memoryGameBtn = document.getElementById('memory-game-btn');
        const reactionGameBtn = document.getElementById('reaction-game-btn');
        const mathGameBtn = document.getElementById('math-game-btn');
        const wordGameBtn = document.getElementById('word-game-btn');
        const memoryGameContainer = document.getElementById('memory-game-container');
        const reactionGameContainer = document.getElementById('reaction-game-container');
        const memoryGameBoard = document.getElementById('memory-game-board');
        const memoryMoves = document.getElementById('memory-moves');
        const memoryTime = document.getElementById('memory-time');
        const memoryScore = document.getElementById('memory-score');
        const memoryRestart = document.getElementById('memory-restart');
        const memoryBack = document.getElementById('memory-back');
        const reactionInstruction = document.getElementById('reaction-instruction');
        const reactionBox = document.getElementById('reaction-box');
        const reactionTime = document.getElementById('reaction-time');
        const bestReaction = document.getElementById('best-reaction');
        const reactionStart = document.getElementById('reaction-start');
        const reactionBack = document.getElementById('reaction-back');
        const langButtons = document.querySelectorAll('.lang-btn');
        const translationInput = document.getElementById('translation-input');
        const translationOutput = document.getElementById('translation-output');
        const translateBtn = document.getElementById('translate-btn');
        const speakInput = document.getElementById('speak-input');
        const speakOutput = document.getElementById('speak-output');
        const copyOutput = document.getElementById('copy-output');
        const translationHistory = document.getElementById('translation-history');

        // Variables d'état
        let currentWeekNumber = 1;
        let completedExercises = JSON.parse(localStorage.getItem('completedExercises')) || {};
        let workoutHistoryData = JSON.parse(localStorage.getItem('workoutHistory')) || [];
        let earnedBadges = JSON.parse(localStorage.getItem('earnedBadges')) || [];
        let userSettings = JSON.parse(localStorage.getItem('userSettings')) || {
            name: "Athlète",
            weeklyGoal: 5,
            theme: "light",
            reminders: false,
            username: "",
            weightGoal: 0,
            workoutDurationGoal: 30,
            points: 0
        };
        let weekNotesData = JSON.parse(localStorage.getItem('weekNotes')) || {};
        let progressPhotosData = JSON.parse(localStorage.getItem('progressPhotos')) || [];
        let nutritionData = JSON.parse(localStorage.getItem('nutritionData')) || {
            caloriesConsumed: 0,
            caloriesBurned: 0,
            proteinIntake: 0,
            waterIntake: 0,
            meals: []
        };
        let communityData = JSON.parse(localStorage.getItem('communityData')) || {
            posts: [],
            ranking: []
        };
        let translationHistoryData = JSON.parse(localStorage.getItem('translationHistory')) || [];
        let currentTimer = null;
        let currentExerciseId = null;
        let timerInterval = null;
        let timerSeconds = 0;
        let musicFiles = [];
        let currentMusicIndex = 0;
        let audioPlayer = new Audio();
        let isPlaying = false;
        let spotifyConnected = false;
        let spotifyPlayerInstance = null;
        let currentSourceLang = 'fr';
        let currentTargetLang = 'en';
        let memoryGameState = {
            cards: [],
            flippedCards: [],
            matchedCards: [],
            moves: 0,
            time: 0,
            timer: null,
            gameStarted: false
        };
        let reactionGameState = {
            waiting: false,
            startTime: 0,
            bestTime: localStorage.getItem('bestReactionTime') || null
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les données sauvegardées
            loadProgress();
            loadUserSettings();
            loadWeekNotes();
            loadProgressPhotos();
            loadNutritionData();
            loadCommunityData();
            loadTranslationHistory();
            
            // Afficher la page d'accueil
            showPage('home');
            
            // Afficher la phrase motivante du jour
            showDailyMotivation();
            
            // Afficher le programme du jour
            displayTodayProgram();
            
            // Afficher le programme de la semaine
            displayWeekProgram();
            
            // Afficher les statistiques
            displayStats();
            
            // Afficher les badges
            displayBadges();
            
            // Afficher l'historique
            displayWorkoutHistory();
            
            // Afficher les données nutritionnelles
            displayNutritionData();
            
            // Afficher les posts de la communauté
            displayCommunityPosts();
            
            // Afficher le classement
            displayCommunityRanking();
            
            // Afficher l'historique des traductions
            displayTranslationHistory();
            
            // Configurer les écouteurs d'événements
            setupEventListeners();
            
            // Vérifier les badges
            checkBadges();
            
            // Vérifier si une semaine est terminée
            checkWeekCompletion();
            
            // Mettre à jour le niveau de l'utilisateur
            updateUserLevel();
            
            // Mettre à jour le meilleur temps de réaction
            if (reactionGameState.bestTime) {
                bestReaction.textContent = reactionGameState.bestTime;
            }
        });

        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            // Navigation
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                    
                    // Mettre à jour l'état actif des boutons
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Navigation entre les semaines
            prevWeekBtn.addEventListener('click', function() {
                if (currentWeekNumber > 1) {
                    currentWeekNumber--;
                    displayWeekProgram();
                    loadWeekNotes();
                }
            });
            
            nextWeekBtn.addEventListener('click', function() {
                if (currentWeekNumber < Object.keys(trainingProgram).length) {
                    currentWeekNumber++;
                    displayWeekProgram();
                    loadWeekNotes();
                }
            });
            
            // Timer
            startTimerBtn.addEventListener('click', startTimer);
            stopTimerBtn.addEventListener('click', stopTimer);
            completeExerciseBtn.addEventListener('click', completeExerciseWithTimer);
            closeTimerBtn.addEventListener('click', closeTimer);
            
            // Célébration
            closeCelebrationBtn.addEventListener('click', closeCelebration);
            
            // Réinitialiser la progression
            resetProgressBtn.addEventListener('click', function() {
                if (confirm("Êtes-vous sûr de vouloir réinitialiser toute votre progression ? Cette action est irréversible.")) {
                    localStorage.removeItem('completedExercises');
                    localStorage.removeItem('workoutHistory');
                    localStorage.removeItem('earnedBadges');
                    localStorage.removeItem('weekNotes');
                    localStorage.removeItem('progressPhotos');
                    localStorage.removeItem('nutritionData');
                    localStorage.removeItem('communityData');
                    localStorage.removeItem('translationHistory');
                    completedExercises = {};
                    workoutHistoryData = [];
                    earnedBadges = [];
                    weekNotesData = {};
                    progressPhotosData = [];
                    nutritionData = {
                        caloriesConsumed: 0,
                        caloriesBurned: 0,
                        proteinIntake: 0,
                        waterIntake: 0,
                        meals: []
                    };
                    communityData = {
                        posts: [],
                        ranking: []
                    };
                    translationHistoryData = [];
                    loadProgress();
                    displayTodayProgram();
                    displayWeekProgram();
                    displayStats();
                    displayBadges();
                    displayWorkoutHistory();
                    displayNutritionData();
                    displayCommunityPosts();
                    displayCommunityRanking();
                    displayTranslationHistory();
                    alert("Progression réinitialisée avec succès !");
                }
            });
            
            // Paramètres utilisateur
            weeklyGoal.addEventListener('change', function() {
                userSettings.weeklyGoal = parseInt(this.value);
                saveUserSettings();
            });
            
            themeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    setTheme(theme);
                    
                    themeButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            remindersToggle.addEventListener('change', function() {
                userSettings.reminders = this.checked;
                saveUserSettings();
                
                if (this.checked) {
                    setupReminders();
                }
            });
            
            // Photos de progression
            photoUpload.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const photoData = {
                            id: Date.now(),
                            data: event.target.result,
                            date: new Date().toISOString()
                        };
                        progressPhotosData.push(photoData);
                        saveProgressPhotos();
                        displayProgressPhotos();
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Export des données
            exportDataBtn.addEventListener('click', exportData);
            
            // Import des données
            importFile.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const importedData = JSON.parse(event.target.result);
                            restoreData(importedData);
                        } catch (error) {
                            alert("Erreur lors de l'importation des données. Le fichier est peut-être corrompu.");
                        }
                    };
                    reader.readAsText(e.target.files[0]);
                }
            });
            
            // Notes de la semaine
            saveNotesBtn.addEventListener('click', saveWeekNotes);
            
            // Musique
            musicFile.addEventListener('change', function(e) {
                if (e.target.files && e.target.files.length > 0) {
                    musicFiles = Array.from(e.target.files);
                    currentMusicIndex = 0;
                    loadMusic(currentMusicIndex);
                }
            });
            
            playMusicBtn.addEventListener('click', toggleMusic);
            prevMusicBtn.addEventListener('click', prevMusic);
            nextMusicBtn.addEventListener('click', nextMusic);
            
            audioPlayer.addEventListener('ended', nextMusic);
            
            // Spotify
            connectSpotifyBtn.addEventListener('click', connectSpotify);
            playTrackBtn.addEventListener('click', toggleSpotifyPlayback);
            prevTrackBtn.addEventListener('click', prevSpotifyTrack);
            nextTrackBtn.addEventListener('click', nextSpotifyTrack);
            shuffleTrackBtn.addEventListener('click', shuffleSpotifyTracks);
            
            // Nutrition
            addNutritionBtn.addEventListener('click', addNutritionEntry);
            addMealBtn.addEventListener('click', addMeal);
            
            // Communauté
            publishPostBtn.addEventListener('click', publishPost);
            
            // Paramètres avancés
            saveAdvancedSettingsBtn.addEventListener('click', saveAdvancedSettings);
            
            // Jeux
            memoryGameBtn.addEventListener('click', showMemoryGame);
            reactionGameBtn.addEventListener('click', showReactionGame);
            mathGameBtn.addEventListener('click', showMathGame);
            wordGameBtn.addEventListener('click', showWordGame);
            memoryRestart.addEventListener('click', initMemoryGame);
            memoryBack.addEventListener('click', hideMemoryGame);
            reactionStart.addEventListener('click', startReactionGame);
            reactionBack.addEventListener('click', hideReactionGame);
            reactionBox.addEventListener('click', handleReactionClick);
            
            // Traducteur
            langButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    setTargetLanguage(lang);
                    
                    langButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            translateBtn.addEventListener('click', translateText);
            speakInput.addEventListener('click', speakInputText);
            speakOutput.addEventListener('click', speakOutputText);
            copyOutput.addEventListener('click', copyTranslation);
        }

        // Afficher une page spécifique
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Masquer les jeux si on change de page
            if (pageId !== 'games') {
                hideMemoryGame();
                hideReactionGame();
            }
            
            // Mettre à jour les données si nécessaire
            if (pageId === 'stats') {
                displayStats();
                displayBadges();
                displayWorkoutHistory();
            } else if (pageId === 'profile') {
                displayProgressPhotos();
            } else if (pageId === 'nutrition') {
                displayNutritionData();
            } else if (pageId === 'community') {
                displayCommunityPosts();
                displayCommunityRanking();
            } else if (pageId === 'translator') {
                displayTranslationHistory();
            }
        }

        // Afficher la phrase motivante du jour
        function showDailyMotivation() {
            const today = new Date().getDate();
            const phraseIndex = today % motivationalPhrases.length;
            dailyMotivation.textContent = motivationalPhrases[phraseIndex];
        }

        // Afficher le programme du jour
        function displayTodayProgram() {
            const weekData = trainingProgram[currentWeekNumber];
            
            // Mettre à jour les durées
            morningDuration.textContent = weekData.morning.duration;
            eveningDuration.textContent = weekData.evening.duration;
            
            // Afficher les exercices du matin
            morningExercises.innerHTML = '';
            weekData.morning.exercises.forEach((exercise, index) => {
                const exerciseId = `week${currentWeekNumber}-morning-${index}`;
                const isCompleted = completedExercises[exerciseId] || false;
                
                const exerciseElement = createExerciseElement(exercise, exerciseId, isCompleted);
                morningExercises.appendChild(exerciseElement);
            });
            
            // Afficher les exercices du soir
            eveningExercises.innerHTML = '';
            weekData.evening.exercises.forEach((exercise, index) => {
                const exerciseId = `week${currentWeekNumber}-evening-${index}`;
                const isCompleted = completedExercises[exerciseId] || false;
                
                const exerciseElement = createExerciseElement(exercise, exerciseId, isCompleted);
                eveningExercises.appendChild(exerciseElement);
            });
            
            // Mettre à jour la barre de progression du jour
            updateDailyProgress();
        }

        // Afficher le programme de la semaine
        function displayWeekProgram() {
            const weekData = trainingProgram[currentWeekNumber];
            
            // Mettre à jour le titre de la semaine
            currentWeek.textContent = weekData.title;
            
            // Afficher les exercices de la semaine
            weekExercises.innerHTML = '';
            
            // Section matin
            const morningSection = document.createElement('div');
            morningSection.className = 'session';
            
            const morningHeader = document.createElement('div');
            morningHeader.className = 'session-header';
            morningHeader.innerHTML = `
                <div class="session-title">Matin</div>
                <div class="session-duration">${weekData.morning.duration}</div>
            `;
            morningSection.appendChild(morningHeader);
            
            weekData.morning.exercises.forEach((exercise, index) => {
                const exerciseId = `week${currentWeekNumber}-morning-${index}`;
                const isCompleted = completedExercises[exerciseId] || false;
                
                const exerciseElement = createExerciseElement(exercise, exerciseId, isCompleted);
                morningSection.appendChild(exerciseElement);
            });
            
            weekExercises.appendChild(morningSection);
            
            // Section soir
            const eveningSection = document.createElement('div');
            eveningSection.className = 'session';
            
            const eveningHeader = document.createElement('div');
            eveningHeader.className = 'session-header';
            eveningHeader.innerHTML = `
                <div class="session-title">Soir</div>
                <div class="session-duration">${weekData.evening.duration}</div>
            `;
            eveningSection.appendChild(eveningHeader);
            
            weekData.evening.exercises.forEach((exercise, index) => {
                const exerciseId = `week${currentWeekNumber}-evening-${index}`;
                const isCompleted = completedExercises[exerciseId] || false;
                
                const exerciseElement = createExerciseElement(exercise, exerciseId, isCompleted);
                eveningSection.appendChild(exerciseElement);
            });
            
            weekExercises.appendChild(eveningSection);
            
            // Mettre à jour la barre de progression de la semaine
            updateWeeklyProgress();
            
            // Mettre à jour l'état des boutons de navigation des semaines
            prevWeekBtn.disabled = currentWeekNumber === 1;
            nextWeekBtn.disabled = currentWeekNumber === Object.keys(trainingProgram).length;
        }

        // Créer un élément d'exercice
        function createExerciseElement(exercise, exerciseId, isCompleted) {
            const exerciseElement = document.createElement('div');
            exerciseElement.className = `exercise ${isCompleted ? 'completed' : ''}`;
            
            exerciseElement.innerHTML = `
                <div class="exercise-icon">
                    <i class="fas ${exercise.icon}"></i>
                </div>
                <div class="exercise-details">
                    <div class="exercise-name">${exercise.name}</div>
                    <div class="exercise-reps">${exercise.reps}</div>
                </div>
                <div class="exercise-actions">
                    <button class="timer-btn" data-exercise-id="${exerciseId}" data-exercise-name="${exercise.name}" data-duration="${exercise.duration}">
                        <i class="fas fa-stopwatch"></i>
                    </button>
                    <div class="checkbox ${isCompleted ? 'checked' : ''}" data-exercise-id="${exerciseId}">
                        ${isCompleted ? '<i class="fas fa-check"></i>' : ''}
                    </div>
                </div>
            `;
            
            // Ajouter un écouteur d'événement pour la case à cocher
            const checkbox = exerciseElement.querySelector('.checkbox');
            checkbox.addEventListener('click', function() {
                const id = this.getAttribute('data-exercise-id');
                toggleExerciseCompletion(id);
            });
            
            // Ajouter un écouteur d'événement pour le timer
            const timerBtn = exerciseElement.querySelector('.timer-btn');
            timerBtn.addEventListener('click', function() {
                const id = this.getAttribute('data-exercise-id');
                const name = this.getAttribute('data-exercise-name');
                const duration = parseInt(this.getAttribute('data-duration'));
                openTimer(id, name, duration);
            });
            
            return exerciseElement;
        }

        // Ouvrir le timer pour un exercice
        function openTimer(exerciseId, exerciseName, duration) {
            currentExerciseId = exerciseId;
            timerSeconds = duration;
            timerExerciseName.textContent = exerciseName;
            updateTimerDisplay();
            
            timerModal.classList.add('active');
            startTimerBtn.style.display = 'block';
            stopTimerBtn.style.display = 'none';
        }

        // Fermer le timer
        function closeTimer() {
            timerModal.classList.remove('active');
            stopTimer();
        }

        // Démarrer le timer
        function startTimer() {
            startTimerBtn.style.display = 'none';
            stopTimerBtn.style.display = 'block';
            
            timerInterval = setInterval(function() {
                timerSeconds--;
                updateTimerDisplay();
                
                if (timerSeconds <= 0) {
                    stopTimer();
                    timerSound.play();
                    completeExerciseWithTimer();
                }
            }, 1000);
        }

        // Arrêter le timer
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Mettre à jour l'affichage du timer
        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Terminer l'exercice avec le timer
        function completeExerciseWithTimer() {
            if (currentExerciseId) {
                toggleExerciseCompletion(currentExerciseId);
                closeTimer();
            }
        }

        // Basculer l'état de complétion d'un exercice
        function toggleExerciseCompletion(exerciseId) {
            completedExercises[exerciseId] = !completedExercises[exerciseId];
            localStorage.setItem('completedExercises', JSON.stringify(completedExercises));
            
            // Jouer le son de feedback
            if (completedExercises[exerciseId]) {
                completeSound.play();
                
                // Ajouter à l'historique
                const now = new Date();
                const historyEntry = {
                    date: now.toISOString(),
                    exerciseId: exerciseId,
                    type: exerciseId.includes('morning') ? 'Matin' : 'Soir'
                };
                workoutHistoryData.unshift(historyEntry);
                localStorage.setItem('workoutHistory', JSON.stringify(workoutHistoryData));
                
                // Ajouter des points
                userSettings.points += 10;
                saveUserSettings();
                updateUserLevel();
                
                // Vérifier les badges
                checkBadges();
                
                // Vérifier si la semaine est terminée
                checkWeekCompletion();
            }
            
            // Mettre à jour l'affichage
            loadProgress();
            displayTodayProgram();
            displayWeekProgram();
        }

        // Charger la progression
        function loadProgress() {
            const savedProgress = localStorage.getItem('completedExercises');
            if (savedProgress) {
                completedExercises = JSON.parse(savedProgress);
            }
        }

        // Charger les paramètres utilisateur
        function loadUserSettings() {
            const savedSettings = localStorage.getItem('userSettings');
            if (savedSettings) {
                userSettings = JSON.parse(savedSettings);
                
                // Appliquer les paramètres
                profileName.textContent = userSettings.name;
                weeklyGoal.value = userSettings.weeklyGoal;
                setTheme(userSettings.theme);
                remindersToggle.checked = userSettings.reminders;
                profilePoints.textContent = `${userSettings.points} points`;
                usernameInput.value = userSettings.username;
                weightGoal.value = userSettings.weightGoal;
                workoutDurationGoal.value = userSettings.workoutDurationGoal;
                
                // Mettre à jour les boutons de thème
                themeButtons.forEach(btn => {
                    if (btn.getAttribute('data-theme') === userSettings.theme) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }

        // Sauvegarder les paramètres utilisateur
        function saveUserSettings() {
            localStorage.setItem('userSettings', JSON.stringify(userSettings));
        }

        // Charger les notes de la semaine
        function loadWeekNotes() {
            const weekKey = `week${currentWeekNumber}`;
            if (weekNotesData[weekKey]) {
                weekNotes.value = weekNotesData[weekKey];
            } else {
                weekNotes.value = '';
            }
        }

        // Sauvegarder les notes de la semaine
        function saveWeekNotes() {
            const weekKey = `week${currentWeekNumber}`;
            weekNotesData[weekKey] = weekNotes.value;
            localStorage.setItem('weekNotes', JSON.stringify(weekNotesData));
            alert("Notes sauvegardées !");
        }

        // Charger les photos de progression
        function loadProgressPhotos() {
            const savedPhotos = localStorage.getItem('progressPhotos');
            if (savedPhotos) {
                progressPhotosData = JSON.parse(savedPhotos);
            }
        }

        // Sauvegarder les photos de progression
        function saveProgressPhotos() {
            localStorage.setItem('progressPhotos', JSON.stringify(progressPhotosData));
        }

        // Afficher les photos de progression
        function displayProgressPhotos() {
            progressPhotos.innerHTML = '';
            
            if (progressPhotosData.length === 0) {
                progressPhotos.innerHTML = '<p style="text-align: center; color: var(--text-light);">Aucune photo de progression</p>';
                return;
            }
            
            progressPhotosData.forEach(photo => {
                const photoElement = document.createElement('div');
                photoElement.style.marginBottom = '15px';
                photoElement.innerHTML = `
                    <img src="${photo.data}" style="width: 100%; border-radius: 8px; margin-bottom: 5px;">
                    <div style="font-size: 0.8rem; color: var(--text-light); text-align: center;">
                        ${new Date(photo.date).toLocaleDateString('fr-FR')}
                    </div>
                `;
                progressPhotos.appendChild(photoElement);
            });
        }

        // Charger les données nutritionnelles
        function loadNutritionData() {
            const savedNutrition = localStorage.getItem('nutritionData');
            if (savedNutrition) {
                nutritionData = JSON.parse(savedNutrition);
            }
        }

        // Sauvegarder les données nutritionnelles
        function saveNutritionData() {
            localStorage.setItem('nutritionData', JSON.stringify(nutritionData));
        }

        // Afficher les données nutritionnelles
        function displayNutritionData() {
            // Mettre à jour les valeurs
            caloriesConsumed.textContent = nutritionData.caloriesConsumed;
            caloriesBurned.textContent = nutritionData.caloriesBurned;
            proteinIntake.textContent = `${nutritionData.proteinIntake}g`;
            waterIntake.textContent = `${nutritionData.waterIntake}L`;
            
            // Afficher les repas
            mealsList.innerHTML = '';
            
            if (nutritionData.meals.length === 0) {
                mealsList.innerHTML = '<p style="text-align: center; color: var(--text-light);">Aucun repas enregistré aujourd\'hui</p>';
            } else {
                nutritionData.meals.forEach(meal => {
                    const mealElement = document.createElement('div');
                    mealElement.className = 'progress-item';
                    mealElement.innerHTML = `
                        <div>
                            <div class="progress-date">${meal.name}</div>
                            <div class="history-session">${meal.calories} calories</div>
                        </div>
                        <div class="progress-value">${meal.time}</div>
                    `;
                    mealsList.appendChild(mealElement);
                });
            }
            
            // Afficher les conseils nutritionnels
            displayNutritionTips();
        }

        // Afficher les conseils nutritionnels
        function displayNutritionTips() {
            const tips = [
                "Buvez au moins 2L d'eau par jour pour une bonne hydratation.",
                "Consommez des protéines à chaque repas pour favoriser la récupération musculaire.",
                "Privilégiez les glucides complexes (riz complet, patates douces) pour une énergie durable.",
                "Les légumes verts sont riches en nutriments essentiels, consommez-en à volonté.",
                "Évitez les aliments transformés et privilégiez les aliments naturels."
            ];
            
            nutritionTips.innerHTML = '';
            
            tips.forEach(tip => {
                const tipElement = document.createElement('div');
                tipElement.className = 'progress-item';
                tipElement.innerHTML = `
                    <div>
                        <i class="fas fa-lightbulb" style="color: var(--warning); margin-right: 10px;"></i>
                        <span>${tip}</span>
                    </div>
                `;
                nutritionTips.appendChild(tipElement);
            });
        }

        // Ajouter une entrée nutritionnelle
        function addNutritionEntry() {
            const calories = prompt("Nombre de calories consommées :");
            if (calories && !isNaN(calories)) {
                nutritionData.caloriesConsumed += parseInt(calories);
                saveNutritionData();
                displayNutritionData();
            }
            
            const protein = prompt("Quantité de protéines consommées (en g) :");
            if (protein && !isNaN(protein)) {
                nutritionData.proteinIntake += parseInt(protein);
                saveNutritionData();
                displayNutritionData();
            }
            
            const water = prompt("Quantité d'eau bue (en L) :");
            if (water && !isNaN(water)) {
                nutritionData.waterIntake += parseFloat(water);
                saveNutritionData();
                displayNutritionData();
            }
        }

        // Ajouter un repas
        function addMeal() {
            const name = prompt("Nom du repas :");
            if (!name) return;
            
            const calories = prompt("Nombre de calories :");
            if (!calories || isNaN(calories)) return;
            
            const time = prompt("Heure du repas (ex: 12:30) :");
            if (!time) return;
            
            const meal = {
                name: name,
                calories: parseInt(calories),
                time: time
            };
            
            nutritionData.meals.push(meal);
            nutritionData.caloriesConsumed += parseInt(calories);
            saveNutritionData();
            displayNutritionData();
        }

        // Charger les données de la communauté
        function loadCommunityData() {
            const savedCommunity = localStorage.getItem('communityData');
            if (savedCommunity) {
                communityData = JSON.parse(savedCommunity);
            }
        }

        // Sauvegarder les données de la communauté
        function saveCommunityData() {
            localStorage.setItem('communityData', JSON.stringify(communityData));
        }

        // Afficher les posts de la communauté
        function displayCommunityPosts() {
            communityPosts.innerHTML = '';
            
            if (communityData.posts.length === 0) {
                communityPosts.innerHTML = '<p style="text-align: center; color: var(--text-light);">Aucun post dans la communauté</p>';
                return;
            }
            
            communityData.posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'community-post';
                postElement.innerHTML = `
                    <div class="post-header">
                        <div class="post-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div class="post-user">${post.user}</div>
                            <div class="post-time">${post.time}</div>
                        </div>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-actions">
                        <div class="post-action">
                            <i class="fas fa-heart"></i>
                            <span>${post.likes}</span>
                        </div>
                        <div class="post-action">
                            <i class="fas fa-comment"></i>
                            <span>${post.comments}</span>
                        </div>
                    </div>
                `;
                communityPosts.appendChild(postElement);
            });
        }

        // Afficher le classement de la communauté
        function displayCommunityRanking() {
            communityRanking.innerHTML = '';
            
            // Générer un classement fictif
            const ranking = [
                { name: "Marie", points: 1250 },
                { name: "Pierre", points: 980 },
                { name: "Sophie", points: 870 },
                { name: "Jean", points: 750 },
                { name: "Alice", points: 620 }
            ];
            
            ranking.forEach((user, index) => {
                const rankElement = document.createElement('div');
                rankElement.className = 'progress-item';
                rankElement.innerHTML = `
                    <div>
                        <span style="font-weight: bold; margin-right: 10px;">${index + 1}.</span>
                        <span>${user.name}</span>
                    </div>
                    <div class="progress-value">${user.points} pts</div>
                `;
                communityRanking.appendChild(rankElement);
            });
        }

        // Publier un post
        function publishPost() {
            const content = newPost.value.trim();
            if (!content) {
                alert("Veuillez écrire un message avant de publier.");
                return;
            }
            
            const now = new Date();
            const post = {
                user: userSettings.username || "Anonyme",
                content: content,
                time: now.toLocaleDateString('fr-FR') + ' ' + now.toLocaleTimeString('fr-FR', {hour: '2-digit', minute:'2-digit'}),
                likes: 0,
                comments: 0
            };
            
            communityData.posts.unshift(post);
            saveCommunityData();
            displayCommunityPosts();
            
            newPost.value = '';
            alert("Post publié avec succès !");
        }

        // Charger l'historique des traductions
        function loadTranslationHistory() {
            const savedHistory = localStorage.getItem('translationHistory');
            if (savedHistory) {
                translationHistoryData = JSON.parse(savedHistory);
            }
        }

        // Sauvegarder l'historique des traductions
        function saveTranslationHistory() {
            localStorage.setItem('translationHistory', JSON.stringify(translationHistoryData));
        }

        // Afficher l'historique des traductions
        function displayTranslationHistory() {
            translationHistory.innerHTML = '';
            
            if (translationHistoryData.length === 0) {
                translationHistory.innerHTML = '<p style="text-align: center; color: var(--text-light);">Aucune traduction enregistrée</p>';
                return;
            }
            
            // Afficher les 10 dernières traductions
            const recentTranslations = translationHistoryData.slice(0, 10);
            
            recentTranslations.forEach(translation => {
                const translationElement = document.createElement('div');
                translationElement.className = 'history-item';
                translationElement.innerHTML = `
                    <div>
                        <div class="history-date">${translation.text}</div>
                        <div class="history-session">${translation.translation}</div>
                    </div>
                    <div>
                        <span style="font-size: 0.8rem; color: var(--text-light);">${translation.from} → ${translation.to}</span>
                    </div>
                `;
                translationHistory.appendChild(translationElement);
            });
        }

        // Mettre à jour la progression du jour
        function updateDailyProgress() {
            const weekData = trainingProgram[currentWeekNumber];
            const totalExercises = weekData.morning.exercises.length + weekData.evening.exercises.length;
            let completedCount = 0;
            
            // Compter les exercices complétés pour aujourd'hui
            for (let i = 0; i < weekData.morning.exercises.length; i++) {
                const exerciseId = `week${currentWeekNumber}-morning-${i}`;
                if (completedExercises[exerciseId]) {
                    completedCount++;
                }
            }
            
            for (let i = 0; i < weekData.evening.exercises.length; i++) {
                const exerciseId = `week${currentWeekNumber}-evening-${i}`;
                if (completedExercises[exerciseId]) {
                    completedCount++;
                }
            }
            
            // Mettre à jour la barre de progression
            const progressPercentage = totalExercises > 0 ? (completedCount / totalExercises) * 100 : 0;
            dailyProgress.style.width = `${progressPercentage}%`;
        }

        // Mettre à jour la progression de la semaine
        function updateWeeklyProgress() {
            const totalExercises = Object.keys(completedExercises).length;
            const allPossibleExercises = calculateTotalExercises();
            const progressPercentage = allPossibleExercises > 0 ? (totalExercises / allPossibleExercises) * 100 : 0;
            weeklyProgress.style.width = `${progressPercentage}%`;
        }

        // Calculer le nombre total d'exercices possibles
        function calculateTotalExercises() {
            let total = 0;
            for (const week in trainingProgram) {
                total += trainingProgram[week].morning.exercises.length;
                total += trainingProgram[week].evening.exercises.length;
            }
            return total;
        }

        // Afficher les statistiques
        function displayStats() {
            // Calculer les statistiques
            const totalWorkouts = workoutHistoryData.length;
            const totalExercises = Object.keys(completedExercises).length;
            const currentStreak = calculateCurrentStreak();
            const completionRate = Math.round((totalExercises / calculateTotalExercises()) * 100);
            
            // Mettre à jour les éléments
            totalWorkoutsEl.textContent = totalWorkouts;
            totalExercisesEl.textContent = totalExercises;
            currentStreakEl.textContent = currentStreak;
            completionRateEl.textContent = `${completionRate}%`;
            
            // Mettre à jour le graphique
            updateProgressChart();
        }

        // Calculer la série actuelle
        function calculateCurrentStreak() {
            if (workoutHistoryData.length === 0) return 0;
            
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Vérifier les 30 derniers jours
            for (let i = 0; i < 30; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(today.getDate() - i);
                const dateStr = checkDate.toISOString().split('T')[0];
                
                const hasWorkout = workoutHistoryData.some(entry => {
                    const entryDate = new Date(entry.date).toISOString().split('T')[0];
                    return entryDate === dateStr;
                });
                
                if (hasWorkout) {
                    streak++;
                } else if (i === 0) {
                    // Aujourd'hui n'a pas d'entraînement, pas de série
                    return 0;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        // Mettre à jour le graphique de progression
        function updateProgressChart() {
            const ctx = progressChart.getContext('2d');
            
            // Préparer les données des 4 dernières semaines
            const labels = [];
            const data = [];
            
            for (let week = 1; week <= 4; week++) {
                labels.push(`Semaine ${week}`);
                
                let completed = 0;
                let total = 0;
                
                if (trainingProgram[week]) {
                    total = trainingProgram[week].morning.exercises.length + trainingProgram[week].evening.exercises.length;
                    
                    for (let i = 0; i < trainingProgram[week].morning.exercises.length; i++) {
                        const exerciseId = `week${week}-morning-${i}`;
                        if (completedExercises[exerciseId]) completed++;
                    }
                    
                    for (let i = 0; i < trainingProgram[week].evening.exercises.length; i++) {
                        const exerciseId = `week${week}-evening-${i}`;
                        if (completedExercises[exerciseId]) completed++;
                    }
                }
                
                const percentage = total > 0 ? (completed / total) * 100 : 0;
                data.push(percentage);
            }
            
            // Créer le graphique
            if (window.progressChartInstance) {
                window.progressChartInstance.destroy();
            }
            
            window.progressChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Progression (%)',
                        data: data,
                        backgroundColor: [
                            'rgba(74, 111, 165, 0.7)',
                            'rgba(107, 186, 167, 0.7)',
                            'rgba(255, 179, 71, 0.7)',
                            'rgba(255, 107, 107, 0.7)'
                        ],
                        borderColor: [
                            'rgb(74, 111, 165)',
                            'rgb(107, 186, 167)',
                            'rgb(255, 179, 71)',
                            'rgb(255, 107, 107)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Afficher les badges
        function displayBadges() {
            badgesContainer.innerHTML = '';
            
            badges.forEach(badge => {
                const isEarned = earnedBadges.includes(badge.id);
                
                const badgeElement = document.createElement('div');
                badgeElement.className = 'badge-item';
                badgeElement.innerHTML = `
                    <div class="badge-icon ${isEarned ? 'earned' : ''}">
                        <i class="fas ${badge.icon}"></i>
                    </div>
                    <div class="badge-name">${badge.name}</div>
                `;
                
                badgesContainer.appendChild(badgeElement);
            });
        }

        // Afficher l'historique des séances
        function displayWorkoutHistory() {
            workoutHistory.innerHTML = '';
            
            if (workoutHistoryData.length === 0) {
                workoutHistory.innerHTML = '<p style="text-align: center; color: var(--text-light);">Aucune séance enregistrée</p>';
                return;
            }
            
            // Afficher les 10 dernières séances
            const recentWorkouts = workoutHistoryData.slice(0, 10);
            
            recentWorkouts.forEach(workout => {
                const workoutDate = new Date(workout.date);
                const workoutElement = document.createElement('div');
                workoutElement.className = 'history-item';
                workoutElement.innerHTML = `
                    <div>
                        <div class="history-date">${workoutDate.toLocaleDateString('fr-FR')}</div>
                        <div class="history-session">${workout.type} - ${workoutDate.toLocaleTimeString('fr-FR', {hour: '2-digit', minute:'2-digit'})}</div>
                    </div>
                    <div>
                        <i class="fas fa-check" style="color: var(--success);"></i>
                    </div>
                `;
                workoutHistory.appendChild(workoutElement);
            });
        }

        // Vérifier les badges
        function checkBadges() {
            const newBadges = [];
            
            // Badge première séance
            if (workoutHistoryData.length >= 1 && !earnedBadges.includes('first_workout')) {
                newBadges.push('first_workout');
            }
            
            // Badge semaine terminée
            for (let week = 1; week <= 4; week++) {
                if (isWeekComplete(week) && !earnedBadges.includes(`week${week}_complete`)) {
                    newBadges.push('week_complete');
                    break;
                }
            }
            
            // Badge mois d'entraînement
            if (Object.keys(completedExercises).length >= 50 && !earnedBadges.includes('month_complete')) {
                newBadges.push('month_complete');
            }
            
            // Badge série de 7 jours
            if (calculateCurrentStreak() >= 7 && !earnedBadges.includes('streak_7')) {
                newBadges.push('streak_7');
            }
            
            // Badge série de 30 jours
            if (calculateCurrentStreak() >= 30 && !earnedBadges.includes('streak_30')) {
                newBadges.push('streak_30');
            }
            
            // Ajouter les nouveaux badges
            newBadges.forEach(badgeId => {
                if (!earnedBadges.includes(badgeId)) {
                    earnedBadges.push(badgeId);
                }
            });
            
            // Sauvegarder les badges
            localStorage.setItem('earnedBadges', JSON.stringify(earnedBadges));
            
            // Afficher une notification pour les nouveaux badges
            if (newBadges.length > 0) {
                displayBadges();
                alert(`Félicitations ! Vous avez débloqué ${newBadges.length} nouveau(x) badge(s) !`);
            }
        }

        // Vérifier si une semaine est terminée
        function checkWeekCompletion() {
            if (isWeekComplete(currentWeekNumber) && !completedExercises[`week${currentWeekNumber}_completed`]) {
                completedExercises[`week${currentWeekNumber}_completed`] = true;
                localStorage.setItem('completedExercises', JSON.stringify(completedExercises));
                
                // Ajouter des points
                userSettings.points += 100;
                saveUserSettings();
                updateUserLevel();
                
                // Afficher l'écran de félicitations
                celebrationMessage.textContent = `Vous avez terminé la semaine ${currentWeekNumber} !`;
                celebration.classList.add('active');
            }
        }

        // Vérifier si une semaine est complète
        function isWeekComplete(week) {
            const weekData = trainingProgram[week];
            if (!weekData) return false;
            
            const totalExercises = weekData.morning.exercises.length + weekData.evening.exercises.length;
            let completedCount = 0;
            
            for (let i = 0; i < weekData.morning.exercises.length; i++) {
                const exerciseId = `week${week}-morning-${i}`;
                if (completedExercises[exerciseId]) completedCount++;
            }
            
            for (let i = 0; i < weekData.evening.exercises.length; i++) {
                const exerciseId = `week${week}-evening-${i}`;
                if (completedExercises[exerciseId]) completedCount++;
            }
            
            return completedCount === totalExercises;
        }

        // Fermer l'écran de félicitations
        function closeCelebration() {
            celebration.classList.remove('active');
        }

        // Définir le thème
        function setTheme(theme) {
            document.body.className = '';
            if (theme !== 'light') {
                document.body.classList.add(`theme-${theme}`);
            }
            
            userSettings.theme = theme;
            saveUserSettings();
        }

        // Configurer les rappels
        function setupReminders() {
            if (!("Notification" in window)) {
                alert("Votre navigateur ne supporte pas les notifications");
                return;
            }
            
            if (Notification.permission === "default") {
                Notification.requestPermission();
            }
            
            // Planifier les rappels (simplifié)
            alert("Rappels activés ! Vous recevrez des notifications pour vos séances du matin et du soir.");
        }

        // Exporter les données
        function exportData() {
            const data = {
                completedExercises: completedExercises,
                workoutHistory: workoutHistoryData,
                earnedBadges: earnedBadges,
                userSettings: userSettings,
                weekNotes: weekNotesData,
                progressPhotos: progressPhotosData.length,
                nutritionData: nutritionData,
                communityData: communityData,
                translationHistory: translationHistoryData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fitprogress-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert("Données exportées avec succès !");
        }

        // Restaurer les données
        function restoreData(importedData) {
            if (confirm("Voulez-vous vraiment restaurer cette sauvegarde ? Vos données actuelles seront écrasées.")) {
                try {
                    if (importedData.completedExercises) completedExercises = importedData.completedExercises;
                    if (importedData.workoutHistory) workoutHistoryData = importedData.workoutHistory;
                    if (importedData.earnedBadges) earnedBadges = importedData.earnedBadges;
                    if (importedData.userSettings) userSettings = importedData.userSettings;
                    if (importedData.weekNotes) weekNotesData = importedData.weekNotes;
                    if (importedData.nutritionData) nutritionData = importedData.nutritionData;
                    if (importedData.communityData) communityData = importedData.communityData;
                    if (importedData.translationHistory) translationHistoryData = importedData.translationHistory;
                    
                    // Sauvegarder les données restaurées
                    localStorage.setItem('completedExercises', JSON.stringify(completedExercises));
                    localStorage.setItem('workoutHistory', JSON.stringify(workoutHistoryData));
                    localStorage.setItem('earnedBadges', JSON.stringify(earnedBadges));
                    localStorage.setItem('userSettings', JSON.stringify(userSettings));
                    localStorage.setItem('weekNotes', JSON.stringify(weekNotesData));
                    localStorage.setItem('nutritionData', JSON.stringify(nutritionData));
                    localStorage.setItem('communityData', JSON.stringify(communityData));
                    localStorage.setItem('translationHistory', JSON.stringify(translationHistoryData));
                    
                    // Recharger l'interface
                    loadProgress();
                    loadUserSettings();
                    loadWeekNotes();
                    loadNutritionData();
                    loadCommunityData();
                    loadTranslationHistory();
                    
                    displayTodayProgram();
                    displayWeekProgram();
                    displayStats();
                    displayBadges();
                    displayWorkoutHistory();
                    displayNutritionData();
                    displayCommunityPosts();
                    displayCommunityRanking();
                    displayTranslationHistory();
                    updateUserLevel();
                    
                    alert("Sauvegarde restaurée avec succès !");
                } catch (error) {
                    alert("Erreur lors de la restauration des données.");
                }
            }
        }

        // Charger la musique
        function loadMusic(index) {
            if (musicFiles.length === 0) return;
            
            const file = musicFiles[index];
            const url = URL.createObjectURL(file);
            audioPlayer.src = url;
            musicTitle.textContent = file.name;
            musicArtist.textContent = "Fichier local";
        }

        // Basculer la lecture de la musique
        function toggleMusic() {
            if (musicFiles.length === 0) {
                alert("Veuillez d'abord importer de la musique");
                return;
            }
            
            if (isPlaying) {
                audioPlayer.pause();
                playMusicBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                audioPlayer.play();
                playMusicBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
            
            isPlaying = !isPlaying;
        }

        // Musique précédente
        function prevMusic() {
            if (musicFiles.length === 0) return;
            
            currentMusicIndex = (currentMusicIndex - 1 + musicFiles.length) % musicFiles.length;
            loadMusic(currentMusicIndex);
            
            if (isPlaying) {
                audioPlayer.play();
            }
        }

        // Musique suivante
        function nextMusic() {
            if (musicFiles.length === 0) return;
            
            currentMusicIndex = (currentMusicIndex + 1) % musicFiles.length;
            loadMusic(currentMusicIndex);
            
            if (isPlaying) {
                audioPlayer.play();
            }
        }

        // Connexion à Spotify (simulée)
        function connectSpotify() {
            // Dans une vraie application, vous utiliseriez l'API Spotify
            // Ici, nous simulons la connexion
            spotifyConnected = true;
            spotifyLogin.style.display = 'none';
            spotifyPlayer.style.display = 'flex';
            
            // Simuler le chargement d'une piste
            trackCover.src = "https://via.placeholder.com/60";
            trackName.textContent = "Workout Motivation Mix";
            trackArtist.textContent = "Various Artists";
            
            // Simuler la progression de la piste
            let progress = 0;
            const progressInterval = setInterval(() => {
                if (progress < 100) {
                    progress += 0.5;
                    trackProgress.style.width = `${progress}%`;
                } else {
                    clearInterval(progressInterval);
                }
            }, 1000);
            
            alert("Connecté à Spotify avec succès !");
        }

        // Basculer la lecture Spotify
        function toggleSpotifyPlayback() {
            if (!spotifyConnected) {
                alert("Veuillez d'abord vous connecter à Spotify");
                return;
            }
            
            // Simulation de lecture
            const icon = playTrackBtn.querySelector('i');
            if (icon.classList.contains('fa-play')) {
                icon.classList.remove('fa-play');
                icon.classList.add('fa-pause');
                alert("Lecture de la musique Spotify...");
            } else {
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
                alert("Musique Spotify en pause");
            }
        }

        // Piste Spotify précédente
        function prevSpotifyTrack() {
            if (!spotifyConnected) {
                alert("Veuillez d'abord vous connecter à Spotify");
                return;
            }
            
            alert("Piste précédente");
        }

        // Piste Spotify suivante
        function nextSpotifyTrack() {
            if (!spotifyConnected) {
                alert("Veuillez d'abord vous connecter à Spotify");
                return;
            }
            
            alert("Piste suivante");
        }

        // Mélanger les pistes Spotify
        function shuffleSpotifyTracks() {
            if (!spotifyConnected) {
                alert("Veuillez d'abord vous connecter à Spotify");
                return;
            }
            
            alert("Lecture aléatoire activée");
        }

        // Sauvegarder les paramètres avancés
        function saveAdvancedSettings() {
            userSettings.username = usernameInput.value;
            userSettings.weightGoal = parseInt(weightGoal.value) || 0;
            userSettings.workoutDurationGoal = parseInt(workoutDurationGoal.value) || 30;
            
            saveUserSettings();
            alert("Paramètres avancés sauvegardés !");
        }

        // Mettre à jour le niveau de l'utilisateur
        function updateUserLevel() {
            const totalExercises = Object.keys(completedExercises).length;
            let level = 1;
            let levelName = "Débutant";
            
            if (totalExercises >= 100) {
                level = 4;
                levelName = "Expert";
            } else if (totalExercises >= 50) {
                level = 3;
                levelName = "Intermédiaire";
            } else if (totalExercises >= 20) {
                level = 2;
                levelName = "Confirmé";
            }
            
            profileLevel.textContent = `Niveau ${level} - ${levelName}`;
            profilePoints.textContent = `${userSettings.points} points`;
        }

        // Jeu de mémoire
        function showMemoryGame() {
            document.querySelector('.games-grid').style.display = 'none';
            memoryGameContainer.style.display = 'block';
            initMemoryGame();
        }

        function hideMemoryGame() {
            document.querySelector('.games-grid').style.display = 'grid';
            memoryGameContainer.style.display = 'none';
            stopMemoryGame();
        }

        function initMemoryGame() {
            // Réinitialiser l'état du jeu
            memoryGameState = {
                cards: [],
                flippedCards: [],
                matchedCards: [],
                moves: 0,
                time: 0,
                timer: null,
                gameStarted: false
            };
            
            // Mettre à jour l'affichage
            memoryMoves.textContent = '0';
            memoryTime.textContent = '0s';
            memoryScore.textContent = '0';
            
            // Créer les cartes
            const symbols = ['🍎', '🍌', '🍒', '🍇', '🍊', '🍓', '🍉', '🍑'];
            const cards = [...symbols, ...symbols]; // Dupliquer pour avoir des paires
            
            // Mélanger les cartes
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            
            memoryGameState.cards = cards;
            
            // Afficher les cartes
            memoryGameBoard.innerHTML = '';
            cards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.index = index;
                card.dataset.symbol = symbol;
                card.textContent = '?';
                card.addEventListener('click', handleMemoryCardClick);
                memoryGameBoard.appendChild(card);
            });
        }

        function handleMemoryCardClick(e) {
            const card = e.target;
            const index = parseInt(card.dataset.index);
            
            // Ne pas permettre de cliquer sur une carte déjà retournée ou appariée
            if (card.classList.contains('flipped') || card.classList.contains('matched')) {
                return;
            }
            
            // Démarrer le timer si c'est la première carte
            if (!memoryGameState.gameStarted) {
                startMemoryTimer();
                memoryGameState.gameStarted = true;
            }
            
            // Retourner la carte
            card.textContent = card.dataset.symbol;
            card.classList.add('flipped');
            memoryGameState.flippedCards.push({ card, index, symbol: card.dataset.symbol });
            
            // Vérifier si deux cartes sont retournées
            if (memoryGameState.flippedCards.length === 2) {
                memoryGameState.moves++;
                memoryMoves.textContent = memoryGameState.moves;
                
                const [card1, card2] = memoryGameState.flippedCards;
                
                if (card1.symbol === card2.symbol) {
                    // Cartes identiques - les marquer comme appariées
                    card1.card.classList.add('matched');
                    card2.card.classList.add('matched');
                    memoryGameState.matchedCards.push(card1, card2);
                    
                    // Mettre à jour le score
                    memoryGameState.score = memoryGameState.matchedCards.length / 2;
                    memoryScore.textContent = memoryGameState.score;
                    
                    // Vérifier si le jeu est terminé
                    if (memoryGameState.matchedCards.length === memoryGameState.cards.length) {
                        setTimeout(() => {
                            alert(`Félicitations ! Vous avez terminé le jeu en ${memoryGameState.moves} coups et ${memoryGameState.time} secondes !`);
                            stopMemoryGame();
                        }, 500);
                    }
                } else {
                    // Cartes différentes - les retourner après un délai
                    setTimeout(() => {
                        card1.card.textContent = '?';
                        card2.card.textContent = '?';
                        card1.card.classList.remove('flipped');
                        card2.card.classList.remove('flipped');
                    }, 1000);
                }
                
                // Vider les cartes retournées
                memoryGameState.flippedCards = [];
            }
        }

        function startMemoryTimer() {
            memoryGameState.timer = setInterval(() => {
                memoryGameState.time++;
                memoryTime.textContent = `${memoryGameState.time}s`;
            }, 1000);
        }

        function stopMemoryGame() {
            if (memoryGameState.timer) {
                clearInterval(memoryGameState.timer);
                memoryGameState.timer = null;
            }
        }

        // Jeu de réaction
        function showReactionGame() {
            document.querySelector('.games-grid').style.display = 'none';
            reactionGameContainer.style.display = 'block';
            resetReactionGame();
        }

        function hideReactionGame() {
            document.querySelector('.games-grid').style.display = 'grid';
            reactionGameContainer.style.display = 'none';
            resetReactionGame();
        }

        function resetReactionGame() {
            reactionGameState.waiting = false;
            reactionBox.style.backgroundColor = var(--primary);
            reactionInstruction.textContent = "Cliquez quand le carré devient vert";
            reactionTime.textContent = "-";
        }

        function startReactionGame() {
            if (reactionGameState.waiting) return;
            
            reactionInstruction.textContent = "Préparez-vous...";
            reactionBox.style.backgroundColor = var(--warning);
            
            // Délai aléatoire entre 2 et 5 secondes
            const delay = Math.random() * 3000 + 2000;
            
            setTimeout(() => {
                reactionInstruction.textContent = "CLIQUEZ MAINTENANT !";
                reactionBox.style.backgroundColor = var(--success);
                reactionGameState.waiting = true;
                reactionGameState.startTime = Date.now();
            }, delay);
        }

        function handleReactionClick() {
            if (!reactionGameState.waiting) {
                startReactionGame();
                return;
            }
            
            const reactionTimeMs = Date.now() - reactionGameState.startTime;
            reactionTime.textContent = reactionTimeMs;
            
            // Mettre à jour le meilleur score
            if (!reactionGameState.bestTime || reactionTimeMs < reactionGameState.bestTime) {
                reactionGameState.bestTime = reactionTimeMs;
                bestReaction.textContent = reactionTimeMs;
                localStorage.setItem('bestReactionTime', reactionTimeMs);
            }
            
            reactionGameState.waiting = false;
            reactionInstruction.textContent = "Cliquez pour recommencer";
            reactionBox.style.backgroundColor = var(--primary);
        }

        // Jeux non implémentés (placeholders)
        function showMathGame() {
            alert("Jeu de calcul mental - À implémenter");
        }

        function showWordGame() {
            alert("Jeu de mots mêlés - À implémenter");
        }

        // Traducteur
        function setTargetLanguage(lang) {
            currentTargetLang = lang;
        }

        function translateText() {
            const text = translationInput.value.trim();
            if (!text) {
                alert("Veuillez entrer un texte à traduire");
                return;
            }
            
            // Traduction simple basée sur le dictionnaire
            let translatedText = text;
            
            // Remplacer les mots connus
            for (const [key, value] of Object.entries(translationDictionary[currentTargetLang])) {
                const regex = new RegExp(`\\b${key}\\b`, 'gi');
                translatedText = translatedText.replace(regex, value);
            }
            
            // Si la traduction n'a pas changé, ajouter un indicateur
            if (translatedText === text) {
                translatedText = `[Traduction non disponible] ${text}`;
            }
            
            translationOutput.value = translatedText;
            
            // Ajouter à l'historique
            const translationEntry = {
                text: text,
                translation: translatedText,
                from: 'fr',
                to: currentTargetLang,
                date: new Date().toISOString()
            };
            
            translationHistoryData.unshift(translationEntry);
            saveTranslationHistory();
            displayTranslationHistory();
        }

        function speakInputText() {
            const text = translationInput.value;
            if (text && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                speechSynthesis.speak(utterance);
            }
        }

        function speakOutputText() {
            const text = translationOutput.value;
            if (text && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Définir la langue en fonction de la langue cible
                const langMap = {
                    'en': 'en-US',
                    'es': 'es-ES',
                    'sw': 'sw-KE'
                };
                
                utterance.lang = langMap[currentTargetLang] || 'fr-FR';
                speechSynthesis.speak(utterance);
            }
        }

        function copyTranslation() {
            const text = translationOutput.value;
            if (text) {
                navigator.clipboard.writeText(text).then(() => {
                    alert("Traduction copiée dans le presse-papier !");
                });
            }
        }
    </script>
</body>
</html>
